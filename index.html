<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RestaurantOS - Plateforme de Gestion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .phase-progress { transition: width 0.3s ease; }
        .task-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .task-card { transition: all 0.2s ease; }
        .modal-enter { animation: fadeIn 0.2s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .notification { animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        
        /* Dark Mode - Plus complet */
        .dark { background-color: #0f172a !important; color: #e2e8f0 !important; }
        .dark body { background-color: #0f172a !important; }
        .dark .bg-white { background-color: #1e293b !important; color: #e2e8f0 !important; }
        .dark .bg-gray-50 { background-color: #0f172a !important; }
        .dark .bg-gray-100 { background-color: #334155 !important; }
        .dark .text-gray-600 { color: #94a3b8 !important; }
        .dark .text-gray-700 { color: #cbd5e1 !important; }
        .dark .text-gray-900 { color: #f1f5f9 !important; }
        .dark .text-gray-500 { color: #64748b !important; }
        .dark .border { border-color: #334155 !important; }
        .dark .border-b { border-bottom-color: #334155 !important; }
        .dark .border-t { border-top-color: #334155 !important; }
        .dark .divide-y > * { border-color: #334155 !important; }
        .dark .shadow { box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.5) !important; }
        .dark .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5) !important; }
        .dark .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5) !important; }
        .dark .hover\:bg-gray-50:hover { background-color: #334155 !important; }
        .dark .hover\:bg-gray-100:hover { background-color: #475569 !important; }
        
        /* Navigation bar dark */
        .dark nav { background-color: #1e293b !important; border-bottom-color: #334155 !important; }
        
        /* Dark mode for all form inputs */
        .dark input[type="text"],
        .dark input[type="email"],
        .dark input[type="tel"],
        .dark input[type="number"],
        .dark input[type="date"],
        .dark input[type="checkbox"],
        .dark textarea,
        .dark select {
            background-color: #334155 !important;
            color: #e2e8f0 !important;
            border-color: #475569 !important;
        }
        
        .dark input[type="text"]:focus,
        .dark input[type="email"]:focus,
        .dark input[type="tel"]:focus,
        .dark input[type="number"]:focus,
        .dark input[type="date"]:focus,
        .dark textarea:focus,
        .dark select:focus {
            background-color: #1e293b !important;
            border-color: #3b82f6 !important;
        }
        
        .dark input::placeholder,
        .dark textarea::placeholder {
            color: #64748b !important;
        }
        
        .dark .editable-number:hover {
            background-color: #334155 !important;
            border-color: #3b82f6 !important;
        }
        
        .dark .task-card {
            background-color: #1e293b !important;
        }
        
        .dark .task-card:hover {
            background-color: #334155 !important;
        }
        
        /* Dark mode for panels and modals */
        .dark .bg-blue-50 { background-color: #1e3a5f !important; }
        .dark .bg-green-50 { background-color: #1e3a2f !important; }
        .dark .bg-yellow-50 { background-color: #3a351e !important; }
        .dark .bg-purple-50 { background-color: #2e1e3a !important; }
        .dark .bg-blue-100 { background-color: #1e40af !important; }
        .dark .bg-green-100 { background-color: #166534 !important; }
        .dark .bg-red-100 { background-color: #991b1b !important; }
        .dark .bg-yellow-100 { background-color: #854d0e !important; }
        .dark .bg-purple-100 { background-color: #6b21a8 !important; }
        .dark .bg-orange-50 { background-color: #3a2e1e !important; }
        
        /* Keep bright colors for tags and badges */
        .dark .text-blue-600 { color: #60a5fa !important; }
        .dark .text-green-600 { color: #4ade80 !important; }
        .dark .text-purple-600 { color: #c084fc !important; }
        .dark .text-red-600 { color: #f87171 !important; }
        .dark .text-orange-600 { color: #fb923c !important; }
        .dark .text-yellow-600 { color: #fbbf24 !important; }
        .dark .text-yellow-800 { color: #fbbf24 !important; }
        .dark .text-blue-800 { color: #93c5fd !important; }
        .dark .text-green-800 { color: #86efac !important; }
        .dark .text-blue-700 { color: #60a5fa !important; }
        .dark .text-green-700 { color: #4ade80 !important; }
        .dark .text-red-700 { color: #f87171 !important; }
        .dark .text-gray-700 { color: #cbd5e1 !important; }
        
        /* Preserve colored borders */
        .dark .border-blue-500 { border-color: #3b82f6 !important; }
        .dark .border-green-500 { border-color: #22c55e !important; }
        .dark .border-yellow-500 { border-color: #eab308 !important; }
        .dark .border-red-500 { border-color: #ef4444 !important; }
        .dark .border-purple-500 { border-color: #a855f7 !important; }
        .dark .border-orange-500 { border-color: #f97316 !important; }
        .dark .border-blue-200 { border-color: #1e40af !important; }
        .dark .border-green-200 { border-color: #166534 !important; }
        .dark .border-purple-200 { border-color: #6b21a8 !important; }
        
        /* Gradients stay vibrant */
        .dark .bg-gradient-to-br { opacity: 0.95; }
        
        /* Special dark backgrounds */
        .dark [class*="bg-gradient"] { opacity: 0.95 !important; }

        /* Editable fields */
        .editable-number { 
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        .editable-number:hover { 
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .editable-number:focus {
            outline: none;
            border-color: #2563eb;
            background-color: white;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-8">
                    <h1 class="text-xl font-bold text-blue-600">üçΩÔ∏è RestaurantOS</h1>
                    <div class="hidden md:flex space-x-4">
                        <button onclick="showPage('dashboard')" class="nav-btn px-3 py-2 rounded hover:bg-gray-100">Dashboard</button>
                        <button onclick="showPage('projects')" class="nav-btn px-3 py-2 rounded hover:bg-gray-100">Projets</button>
                        <button onclick="showPage('tasks')" class="nav-btn px-3 py-2 rounded hover:bg-gray-100">T√¢ches</button>
                        <button onclick="showPage('phases')" class="nav-btn px-3 py-2 rounded hover:bg-gray-100">Phases</button>
                        <button onclick="showPage('features')" class="nav-btn px-3 py-2 rounded hover:bg-gray-100">Features</button>
                        <button onclick="showPage('ai')" class="nav-btn px-3 py-2 rounded hover:bg-gray-100">IA Assistant</button>
                        <button onclick="showPage('analytics')" class="nav-btn px-3 py-2 rounded hover:bg-gray-100">Analytics</button>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button onclick="toggleDarkMode()" class="p-2 hover:bg-gray-100 rounded" title="Mode sombre">
                        <span id="darkModeIcon">üåô</span>
                    </button>
                    <button onclick="toggleNotifications()" class="relative p-2 hover:bg-gray-100 rounded">
                        üîî
                        <span id="notifBadge" class="hidden absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">3</span>
                    </button>
                    <span class="text-sm text-gray-600">üë§ <span id="userName">Fondateur</span></span>
                    <button onclick="logout()" class="text-sm text-red-600 hover:text-red-700">D√©connexion</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Notifications Panel -->
    <div id="notificationsPanel" class="hidden fixed right-4 top-16 w-80 bg-white rounded-lg shadow-xl border z-50">
        <div class="p-4 border-b">
            <h3 class="font-semibold">Notifications</h3>
        </div>
        <div id="notificationsList" class="max-h-96 overflow-y-auto divide-y">
            <!-- Notifications dynamiques -->
        </div>
    </div>

    <!-- PAGE: DASHBOARD -->
    <div id="dashboard" class="page max-w-7xl mx-auto px-4 py-6">
        <!-- KPIs √âditables -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white p-4 rounded-lg shadow">
                <div class="text-sm text-gray-600">Restaurants sign√©s</div>
                <div class="flex items-center justify-center space-x-2 mt-2">
                    <button onclick="changeGoalValue('signedGoal', -1)" class="w-8 h-8 bg-red-500 text-white rounded hover:bg-red-600 text-lg">‚àí</button>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-600">
                            <span id="signedRestaurants">3</span>/<span id="signedGoal" contenteditable="true" class="editable-number inline-block px-2 rounded">10</span>
                        </div>
                    </div>
                    <button onclick="changeGoalValue('signedGoal', 1)" class="w-8 h-8 bg-green-500 text-white rounded hover:bg-green-600 text-lg">+</button>
                </div>
                <div class="text-xs text-gray-500 mt-1 text-center">Objectif mois</div>
            </div>
            
            <div class="bg-white p-4 rounded-lg shadow">
                <div class="text-sm text-gray-600">Revenu MRR</div>
                <div class="text-center mt-2">
                    <input id="mrr" type="number" value="1200" onchange="updateMRR(this.value)" class="text-2xl font-bold text-green-600 text-center w-24 border-0 editable-number rounded px-2">
                    <span class="text-2xl font-bold text-green-600">‚Ç¨</span>
                    <div class="text-xs text-gray-500 mt-1">
                        / <input id="mrrGoal" type="number" value="5000" class="w-16 text-xs border-0 editable-number rounded px-1" onchange="saveData()">‚Ç¨ objectif
                    </div>
                </div>
            </div>
            
            <div class="bg-white p-4 rounded-lg shadow">
                <div class="text-sm text-gray-600">T√¢ches compl√©t√©es</div>
                <div class="text-2xl font-bold text-purple-600 text-center mt-2">
                    <span id="completedTasks">0</span>/<span id="totalTasks">0</span>
                </div>
                <div class="text-xs text-gray-500 mt-1 text-center"><span id="completionPercent">0</span>% de progression</div>
            </div>
            
            <div class="bg-white p-4 rounded-lg shadow">
                <div class="text-sm text-gray-600">T√¢ches en cours</div>
                <div class="text-2xl font-bold text-orange-600 text-center mt-2"><span id="ongoingTasks">0</span></div>
                <div class="text-xs text-gray-500 mt-1 text-center">√Ä suivre</div>
            </div>
        </div>

        <!-- Projets actifs -->
        <div class="bg-white rounded-lg shadow mb-6">
            <div class="p-4 border-b">
                <h2 class="text-lg font-semibold">üöÄ Projets Actifs</h2>
            </div>
            <div id="activeProjects" class="divide-y">
                <!-- Projects loaded dynamically -->
            </div>
        </div>

        <!-- T√¢ches urgentes et IA -->
        <div class="grid md:grid-cols-2 gap-6">
            <div class="bg-white rounded-lg shadow">
                <div class="p-4 border-b">
                    <h2 class="text-lg font-semibold">‚úÖ Mes T√¢ches Prioritaires</h2>
                </div>
                <div id="urgentTasks" class="p-4 space-y-3">
                    <!-- Tasks loaded dynamically -->
                </div>
            </div>

            <div class="bg-blue-50 rounded-lg shadow border-2 border-blue-200">
                <div class="p-4 border-b border-blue-200 bg-blue-100">
                    <h2 class="text-lg font-semibold text-blue-800">üí° IA Assistant</h2>
                </div>
                <div class="p-4">
                    <div class="bg-white rounded p-3 mb-3 text-sm">
                        <strong>Suggestion du jour:</strong><br>
                        Commence par les t√¢ches prioritaires pour maximiser ton efficacit√©.
                    </div>
                    <button onclick="openAI()" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                        Discuter avec l'IA
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- PAGE: PROJECTS -->
    <div id="projects" class="page hidden max-w-7xl mx-auto px-4 py-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">üìÅ Tous les Projets</h2>
            <button onclick="openProjectModal()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                + Nouveau Restaurant
            </button>
        </div>

        <div id="projectsList" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Projects loaded dynamically -->
        </div>
    </div>

    <!-- PAGE: TASKS -->
    <div id="tasks" class="page hidden max-w-7xl mx-auto px-4 py-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">üìã Gestion des T√¢ches</h2>
            <div class="flex space-x-2">
                <select onchange="filterTasks(this.value)" class="border rounded px-3 py-2 bg-white">
                    <option value="all">Toutes</option>
                    <option value="todo">√Ä faire</option>
                    <option value="doing">En cours</option>
                    <option value="blocked">Bloqu√©es</option>
                    <option value="done">Termin√©es</option>
                </select>
                <button onclick="openTaskModal()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                    + Nouvelle T√¢che
                </button>
            </div>
        </div>

        <div id="tasksBoard" class="grid md:grid-cols-4 gap-4">
            <div class="bg-gray-100 rounded-lg p-4">
                <h3 class="font-semibold mb-3 text-gray-700">üìù √Ä faire (<span id="todoCount">0</span>)</h3>
                <div id="todoColumn" class="space-y-2"></div>
            </div>
            <div class="bg-blue-100 rounded-lg p-4">
                <h3 class="font-semibold mb-3 text-blue-700">üîÑ En cours (<span id="doingCount">0</span>)</h3>
                <div id="doingColumn" class="space-y-2"></div>
            </div>
            <div class="bg-red-100 rounded-lg p-4">
                <h3 class="font-semibold mb-3 text-red-700">‚ö†Ô∏è Bloqu√©es (<span id="blockedCount">0</span>)</h3>
                <div id="blockedColumn" class="space-y-2"></div>
            </div>
            <div class="bg-green-100 rounded-lg p-4">
                <h3 class="font-semibold mb-3 text-green-700">‚úÖ Termin√©es (<span id="doneCount">0</span>)</h3>
                <div id="doneColumn" class="space-y-2"></div>
            </div>
        </div>
    </div>

    <!-- PAGE: PHASES -->
    <div id="phases" class="page hidden max-w-7xl mx-auto px-4 py-6">
        <h2 class="text-2xl font-bold mb-6">üéØ Gestion des Phases</h2>
        
        <div class="space-y-6">
            <!-- Phase 1 -->
            <div class="bg-white rounded-lg shadow">
                <div class="p-4 border-b bg-blue-50">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-bold text-blue-800">Phase 1 - D√©mo Fonctionnelle</h3>
                        <span class="text-sm text-gray-600">7-10 jours</span>
                    </div>
                </div>
                <div class="p-4">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="font-semibold mb-2 text-blue-600">üíª CODE</h4>
                            <ul class="space-y-2 text-sm">
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Structure HTML/CSS du site restaurant</span>
                                </li>
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Interface admin basique</span>
                                </li>
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Base de donn√©es (menu, r√©servations)</span>
                                </li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2 text-purple-600">üß† IA & STRAT√âGIE</h4>
                            <ul class="space-y-2 text-sm">
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>R√©daction prompt ma√Ætre IA restaurant</span>
                                </li>
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Liste de 10 arguments de vente</span>
                                </li>
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>√âtude de march√© locale (3 concurrents)</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 2 -->
            <div class="bg-white rounded-lg shadow">
                <div class="p-4 border-b bg-green-50">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-bold text-green-800">Phase 2 - Int√©gration & Intelligence</h3>
                        <span class="text-sm text-gray-600">5-7 jours</span>
                    </div>
                </div>
                <div class="p-4">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="font-semibold mb-2 text-blue-600">üíª CODE</h4>
                            <ul class="space-y-2 text-sm">
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Connexion API OpenAI</span>
                                </li>
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Syst√®me notifications email</span>
                                </li>
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>G√©n√©rateur QR Code dynamique</span>
                                </li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2 text-purple-600">üß† IA & STRAT√âGIE</h4>
                            <ul class="space-y-2 text-sm">
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Tests prompts (20 sc√©narios difficiles)</span>
                                </li>
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Calcul √©conomies mensuelles restaurant</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 3 -->
            <div class="bg-white rounded-lg shadow">
                <div class="p-4 border-b bg-yellow-50">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-bold text-yellow-800">Phase 3 - Communication & Lancement</h3>
                        <span class="text-sm text-gray-600">3-5 jours</span>
                    </div>
                </div>
                <div class="p-4">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="font-semibold mb-2 text-blue-600">üíª CODE</h4>
                            <ul class="space-y-2 text-sm">
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Optimisation mobile responsive</span>
                                </li>
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>D√©ploiement production (h√©bergement)</span>
                                </li>
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Acc√®s Admin client configur√©</span>
                                </li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2 text-purple-600">üß† IA & STRAT√âGIE</h4>
                            <ul class="space-y-2 text-sm">
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Identit√© visuelle (nom, logo, couleurs)</span>
                                </li>
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Script de vente cold calling</span>
                                </li>
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Deck pr√©sentation client</span>
                                </li>
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Process onboarding + formation</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 4 -->
            <div class="bg-white rounded-lg shadow">
                <div class="p-4 border-b bg-purple-50">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-bold text-purple-800">Phase 4 - Suivi & Croissance</h3>
                        <span class="text-sm text-gray-600">Continu</span>
                    </div>
                </div>
                <div class="p-4">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="font-semibold mb-2 text-blue-600">üíª CODE</h4>
                            <ul class="space-y-2 text-sm">
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Automatisation cr√©ation sites (template)</span>
                                </li>
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Int√©gration Stripe (paiements)</span>
                                </li>
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Syst√®me fid√©lit√© client</span>
                                </li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2 text-purple-600">üß† IA & STRAT√âGIE</h4>
                            <ul class="space-y-2 text-sm">
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Collecte t√©moignages clients</span>
                                </li>
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Contenu LinkedIn/TikTok r√©gulier</span>
                                </li>
                                <li class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-2">
                                    <span>Strat√©gie parrainage (20‚Ç¨‚Üí15‚Ç¨)</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PAGE: FEATURES RESTAURANT -->
    <div id="features" class="page hidden max-w-7xl mx-auto px-4 py-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">‚öôÔ∏è Features Restaurant Disponibles</h2>
            <button onclick="openFeatureModal()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                + Ajouter une Feature
            </button>
        </div>
        
        <div id="featuresList" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Features loaded dynamically -->
        </div>
    </div>

    <!-- PAGE: ANALYTICS -->
    <div id="analytics" class="page hidden max-w-7xl mx-auto px-4 py-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">üìà Analytics Business</h2>
            <button onclick="openAnalyticsModal()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                ‚öôÔ∏è Modifier les m√©triques
            </button>
        </div>
        
        <div class="grid md:grid-cols-3 gap-6 mb-6">
            <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-lg shadow-lg p-6">
                <div class="text-sm opacity-90 mb-2">Revenus totaux (ann√©e)</div>
                <div class="text-3xl font-bold"><span id="analyticsYearRevenue">14400</span>‚Ç¨</div>
                <div class="text-sm mt-2 opacity-75">+<span id="analyticsYearGrowth">32</span>% vs ann√©e derni√®re</div>
            </div>

            <div class="bg-gradient-to-br from-green-500 to-green-600 text-white rounded-lg shadow-lg p-6">
                <div class="text-sm opacity-90 mb-2">Temps gagn√© clients</div>
                <div class="text-3xl font-bold"><span id="analyticsTimeSaved">540</span>h/mois</div>
                <div class="text-sm mt-2 opacity-75">Pour <span id="analyticsActiveClients">3</span> restaurants actifs</div>
            </div>

            <div class="bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-lg shadow-lg p-6">
                <div class="text-sm opacity-90 mb-2">Taux de conversion</div>
                <div class="text-3xl font-bold"><span id="analyticsConversionRate">30</span>%</div>
                <div class="text-sm mt-2 opacity-75">D√©mo ‚Üí Client sign√©</div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h3 class="font-bold text-lg mb-4">üí∞ Taille des Contrats</h3>
            <div id="contractSizeList" class="space-y-3">
                <!-- Contract sizes loaded dynamically -->
            </div>
            <button onclick="openContractModal()" class="mt-4 w-full border-2 border-dashed border-gray-300 rounded p-3 hover:border-blue-500 hover:bg-blue-50 text-gray-600">
                + Ajouter un type de contrat
            </button>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="font-bold text-lg mb-4">üìä R√©partition des revenus</h3>
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-semibold mb-3 text-sm text-gray-600">Par type de contrat</h4>
                    <div id="revenueByContractType" class="space-y-2">
                        <!-- Revenue breakdown loaded dynamically -->
                    </div>
                </div>
                <div>
                    <h4 class="font-semibold mb-3 text-sm text-gray-600">Statistiques</h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span>Contrat moyen:</span>
                            <span class="font-bold"><span id="avgContract">400</span>‚Ç¨/mois</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Plus gros contrat:</span>
                            <span class="font-bold"><span id="maxContract">450</span>‚Ç¨/mois</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Plus petit contrat:</span>
                            <span class="font-bold"><span id="minContract">350</span>‚Ç¨/mois</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PAGE: AI ASSISTANT -->
    <div id="ai" class="page hidden max-w-4xl mx-auto px-4 py-6">
        <div class="bg-white rounded-lg shadow">
            <div class="p-4 border-b bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-t-lg">
                <h2 class="text-xl font-bold">ü§ñ Assistant IA RestaurantOS</h2>
                <p class="text-sm opacity-90">Ton copilote pour g√©rer ton agence</p>
            </div>
            
            <div id="chatMessages" class="p-4 h-96 overflow-y-auto space-y-3">
                <div class="bg-blue-50 p-3 rounded-lg">
                    <strong>IA:</strong> Bonjour ! Je suis l√† pour t'aider. Que veux-tu faire aujourd'hui ?
                    <div class="mt-2 flex flex-wrap gap-2">
                        <button onclick="askAI('priorities')" class="text-xs bg-white px-3 py-1 rounded border hover:bg-gray-50">Mes priorit√©s du jour</button>
                        <button onclick="askAI('script')" class="text-xs bg-white px-3 py-1 rounded border hover:bg-gray-50">G√©n√©rer un script de vente</button>
                        <button onclick="askAI('objection')" class="text-xs bg-white px-3 py-1 rounded border hover:bg-gray-50">Simuler une objection client</button>
                        <button onclick="askAI('email')" class="text-xs bg-white px-3 py-1 rounded border hover:bg-gray-50">Email de prospection</button>
                    </div>
                </div>
            </div>
            
            <div class="p-4 border-t">
                <div class="flex space-x-2">
                    <input id="aiInput" type="text" placeholder="Pose ta question..." class="flex-1 border rounded px-3 py-2 bg-white" onkeypress="if(event.key==='Enter') sendAIMessage()">
                    <button onclick="sendAIMessage()" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">Envoyer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Nouveau/Modifier Projet -->
    <div id="projectModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal-enter">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 id="projectModalTitle" class="text-xl font-bold mb-4">üçΩÔ∏è Nouveau Restaurant</h3>
            <div class="space-y-3">
                <input id="editProjectId" type="hidden">
                <input id="newProjectName" type="text" placeholder="Nom du restaurant *" class="w-full border rounded px-3 py-2 bg-white">
                <input id="newProjectContact" type="email" placeholder="Email de contact *" class="w-full border rounded px-3 py-2 bg-white">
                <input id="newProjectPhone" type="tel" placeholder="T√©l√©phone" class="w-full border rounded px-3 py-2 bg-white">
                <select id="newProjectStatus" class="w-full border rounded px-3 py-2 bg-white">
                    <option value="prospect">Prospect</option>
                    <option value="demo">D√©mo en cours</option>
                    <option value="active">Client actif</option>
                    <option value="churned">Inactif</option>
                </select>
                <input id="newProjectRevenue" type="number" placeholder="Revenu mensuel (‚Ç¨)" class="w-full border rounded px-3 py-2 bg-white">
                <select id="newProjectAssignee" class="w-full border rounded px-3 py-2 bg-white">
                    <option value="Marc">Marc</option>
                    <option value="Julie">Julie</option>
                    <option value="Sophie">Sophie</option>
                </select>
                <select id="newProjectPhase" class="w-full border rounded px-3 py-2 bg-white">
                    <option value="1">Phase 1 - D√©mo</option>
                    <option value="2">Phase 2 - Int√©gration</option>
                    <option value="3">Phase 3 - Lancement</option>
                    <option value="4">Phase 4 - Croissance</option>
                </select>
                <input id="newProjectProgress" type="number" min="0" max="100" placeholder="Progression (%)" class="w-full border rounded px-3 py-2 bg-white">
                
                <div>
                    <label class="block text-sm font-semibold mb-2">Features activ√©es:</label>
                    <div id="projectFeaturesCheckboxes" class="space-y-2 max-h-40 overflow-y-auto border rounded p-3 bg-gray-50">
                        <!-- Features checkboxes loaded dynamically -->
                    </div>
                </div>
            </div>
            <div class="flex space-x-2 mt-4">
                <button onclick="closeProjectModal()" class="flex-1 border rounded py-2 hover:bg-gray-50">Annuler</button>
                <button onclick="saveProject()" class="flex-1 bg-blue-600 text-white rounded py-2 hover:bg-blue-700">Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Nouvelle T√¢che -->
    <div id="taskModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal-enter">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold mb-4">‚ûï Nouvelle T√¢che</h3>
            <div class="space-y-3">
                <input id="newTaskTitle" type="text" placeholder="Titre de la t√¢che *" class="w-full border rounded px-3 py-2 bg-white">
                <textarea id="newTaskDesc" placeholder="Description..." class="w-full border rounded px-3 py-2 h-20 bg-white"></textarea>
                <select id="newTaskProject" class="w-full border rounded px-3 py-2 bg-white">
                    <option value="">S√©lectionner un projet *</option>
                </select>
                <select id="newTaskPhase" class="w-full border rounded px-3 py-2 bg-white">
                    <option value="1">Phase 1 - D√©mo</option>
                    <option value="2">Phase 2 - Int√©gration</option>
                    <option value="3">Phase 3 - Lancement</option>
                    <option value="4">Phase 4 - Croissance</option>
                </select>
                <select id="newTaskAssignee" class="w-full border rounded px-3 py-2 bg-white">
                    <option value="Marc">Marc</option>
                    <option value="Julie">Julie</option>
                    <option value="Sophie">Sophie</option>
                </select>
                <select id="newTaskPriority" class="w-full border rounded px-3 py-2 bg-white">
                    <option value="low">Basse</option>
                    <option value="medium">Moyenne</option>
                    <option value="high">Haute</option>
                    <option value="urgent">Urgente</option>
                </select>
                <input id="newTaskDeadline" type="date" class="w-full border rounded px-3 py-2 bg-white">
                <input id="newTaskGoal" type="text" placeholder="Objectif business" class="w-full border rounded px-3 py-2 bg-white">
            </div>
            <div class="flex space-x-2 mt-4">
                <button onclick="closeTaskModal()" class="flex-1 border rounded py-2 hover:bg-gray-50">Annuler</button>
                <button onclick="createTask()" class="flex-1 bg-blue-600 text-white rounded py-2 hover:bg-blue-700">Cr√©er</button>
            </div>
        </div>
    </div>

    <!-- MODAL: D√©tail Projet -->
    <div id="projectDetailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal-enter">
        <div class="bg-white rounded-lg max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b sticky top-0 bg-white">
                <div class="flex justify-between items-center">
                    <h3 id="modalProjectName" class="text-2xl font-bold">Restaurant Name</h3>
                    <div class="flex space-x-2">
                        <button onclick="editProjectFromDetail()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">‚úèÔ∏è Modifier</button>
                        <button onclick="deleteProjectConfirm()" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">üóëÔ∏è Supprimer</button>
                        <button onclick="closeProjectDetailModal()" class="text-gray-500 hover:text-gray-700 text-2xl ml-2">&times;</button>
                    </div>
                </div>
            </div>
            
            <div class="p-6">
                <div class="grid md:grid-cols-3 gap-6 mb-6">
                    <div class="border rounded-lg p-4">
                        <div class="text-sm text-gray-600">Phase actuelle</div>
                        <div id="modalPhase" class="text-2xl font-bold text-blue-600">2/4</div>
                    </div>
                    <div class="border rounded-lg p-4">
                        <div class="text-sm text-gray-600">Progression</div>
                        <div id="modalProgress" class="text-2xl font-bold text-green-600">65%</div>
                    </div>
                    <div class="border rounded-lg p-4">
                        <div class="text-sm text-gray-600">Revenu MRR</div>
                        <div id="modalRevenue" class="text-2xl font-bold text-purple-600">400‚Ç¨</div>
                    </div>
                </div>

                <div class="mb-6">
                    <h4 class="font-bold mb-3">üìã T√¢ches du projet</h4>
                    <div id="modalTasks" class="space-y-2">
                        <!-- Tasks loaded dynamically -->
                    </div>
                </div>

                <div class="mb-6">
                    <h4 class="font-bold mb-3">üìû Informations de contact</h4>
                    <div class="bg-gray-50 rounded p-4 space-y-2 text-sm">
                        <div><strong>Email:</strong> <span id="modalEmail"></span></div>
                        <div><strong>T√©l√©phone:</strong> <span id="modalPhone"></span></div>
                        <div><strong>Responsable:</strong> <span id="modalAssignee"></span></div>
                        <div><strong>Statut:</strong> <span id="modalStatus"></span></div>
                    </div>
                </div>

                <div>
                    <h4 class="font-bold mb-3">‚öôÔ∏è Modules activ√©s</h4>
                    <div id="modalFeatures" class="flex flex-wrap gap-2">
                        <!-- Features loaded dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Ajouter Feature -->
    <div id="featureModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal-enter">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold mb-4">‚ûï Ajouter une Feature</h3>
            <div class="space-y-3">
                <input id="newFeatureName" type="text" placeholder="Nom de la feature *" class="w-full border rounded px-3 py-2 bg-white">
                <input id="newFeatureIcon" type="text" placeholder="Emoji (ex: üéØ)" class="w-full border rounded px-3 py-2 bg-white">
                <textarea id="newFeatureDesc" placeholder="Description..." class="w-full border rounded px-3 py-2 h-20 bg-white"></textarea>
                <select id="newFeatureType" class="w-full border rounded px-3 py-2 bg-white">
                    <option value="included">Inclus (gratuit)</option>
                    <option value="premium">Premium (payant)</option>
                </select>
                <input id="newFeaturePrice" type="number" placeholder="Prix mensuel (‚Ç¨)" class="w-full border rounded px-3 py-2 bg-white" min="0">
            </div>
            <div class="flex space-x-2 mt-4">
                <button onclick="closeFeatureModal()" class="flex-1 border rounded py-2 hover:bg-gray-50">Annuler</button>
                <button onclick="createFeature()" class="flex-1 bg-blue-600 text-white rounded py-2 hover:bg-blue-700">Cr√©er</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Modifier Analytics -->
    <div id="analyticsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal-enter">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold mb-4">‚öôÔ∏è Modifier les M√©triques Analytics</h3>
            <div class="space-y-3">
                <div>
                    <label class="block text-sm font-semibold mb-1">Revenus annuels (‚Ç¨)</label>
                    <input id="editYearRevenue" type="number" class="w-full border rounded px-3 py-2 bg-white">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-1">Croissance annuelle (%)</label>
                    <input id="editYearGrowth" type="number" class="w-full border rounded px-3 py-2 bg-white">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-1">Temps gagn√© clients (h/mois)</label>
                    <input id="editTimeSaved" type="number" class="w-full border rounded px-3 py-2 bg-white">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-1">Taux de conversion (%)</label>
                    <input id="editConversionRate" type="number" class="w-full border rounded px-3 py-2 bg-white">
                </div>
            </div>
            <div class="flex space-x-2 mt-4">
                <button onclick="closeAnalyticsModal()" class="flex-1 border rounded py-2 hover:bg-gray-50">Annuler</button>
                <button onclick="saveAnalytics()" class="flex-1 bg-blue-600 text-white rounded py-2 hover:bg-blue-700">Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Ajouter Type de Contrat -->
    <div id="contractModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal-enter">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold mb-4">‚ûï Ajouter un Type de Contrat</h3>
            <div class="space-y-3">
                <input id="newContractName" type="text" placeholder="Nom du contrat *" class="w-full border rounded px-3 py-2 bg-white">
                <input id="newContractPrice" type="number" placeholder="Prix mensuel (‚Ç¨) *" class="w-full border rounded px-3 py-2 bg-white">
                <textarea id="newContractDesc" placeholder="Description..." class="w-full border rounded px-3 py-2 h-20 bg-white"></textarea>
                <select id="newContractColor" class="w-full border rounded px-3 py-2 bg-white">
                    <option value="blue">Bleu</option>
                    <option value="green">Vert</option>
                    <option value="purple">Violet</option>
                    <option value="orange">Orange</option>
                    <option value="red">Rouge</option>
                    <option value="pink">Rose</option>
                </select>
            </div>
            <div class="flex space-x-2 mt-4">
                <button onclick="closeContractModal()" class="flex-1 border rounded py-2 hover:bg-gray-50">Annuler</button>
                <button onclick="createContract()" class="flex-1 bg-blue-600 text-white rounded py-2 hover:bg-blue-700">Cr√©er</button>
            </div>
        </div>
    </div>

    <script>
        // DATA STRUCTURE
        let data = {
            settings: {
                signedGoal: 10,
                mrrGoal: 5000,
                currentMRR: 1200
            },
            projects: [
                {id: 1, name: "La Bella Vita", contact: "contact@bellavita.fr", phone: "0612345678", status: "active", revenue: 400, phase: 2, progress: 65, assignee: "Marc", features: ["reservations", "menus", "messaging"]},
                {id: 2, name: "Sushi Zen", contact: "sushi@zen.fr", phone: "0698765432", status: "demo", revenue: 350, phase: 1, progress: 20, assignee: "Julie", features: ["reservations", "menus"]},
                {id: 3, name: "Le Gourmet", contact: "contact@legourmet.fr", phone: "0687654321", status: "active", revenue: 450, phase: 3, progress: 85, assignee: "Sophie", features: ["reservations", "menus", "messaging", "orders"]}
            ],
            tasks: [
                {id: 1, projectId: 1, title: "Finaliser prompt IA", desc: "Optimiser les r√©ponses pour les allergies", phase: 2, assignee: "Marc", status: "doing", priority: "high", deadline: "2025-12-27", goal: "Am√©liorer satisfaction client"},
                {id: 2, projectId: 2, title: "D√©ployer site", desc: "Mise en production sur Vercel", phase: 1, assignee: "Julie", status: "todo", priority: "urgent", deadline: "2025-12-28", goal: "Lancer la d√©mo client"},
                {id: 3, projectId: 1, title: "Int√©grer Stripe", desc: "Paiements en ligne", phase: 2, assignee: "Marc", status: "todo", priority: "medium", deadline: "2025-12-30", goal: "G√©n√©rer revenus suppl√©mentaires"},
                {id: 4, projectId: 3, title: "Formation client", desc: "Onboarding √©quipe restaurant", phase: 3, assignee: "Sophie", status: "done", priority: "high", deadline: "2025-12-23", goal: "Autonomie du client"},
                {id: 5, projectId: 2, title: "Script de vente", desc: "R√©diger pitch pour cold calling", phase: 1, assignee: "Julie", status: "doing", priority: "high", deadline: "2025-12-26", goal: "Augmenter taux de conversion"}
            ],
            features: [
                {id: 1, name: "R√©servations en ligne", icon: "üìÖ", desc: "Syst√®me de r√©servation automatis√© avec confirmation email", type: "included", price: 0},
                {id: 2, name: "Menus digitaux", icon: "üçΩÔ∏è", desc: "QR Code menu dynamique mis √† jour en temps r√©el", type: "included", price: 0},
                {id: 3, name: "Messagerie √©quipe", icon: "üí¨", desc: "Communication interne pour le personnel", type: "included", price: 0},
                {id: 4, name: "Commandes en ligne", icon: "üõí", desc: "Click & collect / livraison int√©gr√©e", type: "premium", price: 5},
                {id: 5, name: "Statistiques avanc√©es", icon: "üìä", desc: "Analytics d√©taill√©es de fr√©quentation et revenus", type: "premium", price: 3},
                {id: 6, name: "Fid√©lisation clients", icon: "üéÅ", desc: "Programme de points et r√©compenses", type: "premium", price: 2}
            ],
            analytics: {
                yearRevenue: 14400,
                yearGrowth: 32,
                timeSaved: 540,
                conversionRate: 30
            },
            contracts: [
                {id: 1, name: "Starter", price: 350, desc: "Pour petits restaurants", color: "blue"},
                {id: 2, name: "Standard", price: 400, desc: "Forfait classique", color: "green"},
                {id: 3, name: "Premium", price: 450, desc: "Toutes les features", color: "purple"}
            ],
            notifications: [],
            darkMode: true // Mode sombre par d√©faut
        };

        let currentUser = "Marc";
        let currentProjectId = null;

        // DARK MODE
        function toggleDarkMode() {
            data.darkMode = !data.darkMode;
            document.body.classList.toggle('dark', data.darkMode);
            document.getElementById('darkModeIcon').textContent = data.darkMode ? '‚òÄÔ∏è' : 'üåô';
            saveData();
        }

        function loadDarkMode() {
            // Mode sombre activ√© par d√©faut
            document.body.classList.add('dark');
            document.getElementById('darkModeIcon').textContent = '‚òÄÔ∏è';
        }

        // EDITABLE GOALS
        function changeGoalValue(elementId, delta) {
            const el = document.getElementById(elementId);
            let value = parseInt(el.textContent) || 0;
            value = Math.max(0, value + delta);
            el.textContent = value;
            data.settings.signedGoal = value;
            saveData();
        }

        // Rendre les champs √©ditables au clavier
        document.addEventListener('DOMContentLoaded', () => {
            document.addEventListener('input', (e) => {
                if (e.target.id === 'signedGoal') {
                    data.settings.signedGoal = parseInt(e.target.textContent) || 10;
                    saveData();
                } else if (e.target.id === 'mrrGoal') {
                    data.settings.mrrGoal = parseInt(e.target.value) || 5000;
                    saveData();
                }
            });
        });

        function updateMRR(value) {
            data.settings.currentMRR = parseInt(value) || 0;
            saveData();
        }

        // INIT
        function init() {
            loadDashboard();
            loadProjects();
            loadTasks();
            loadNotifications();
            loadFeatures();
            loadAnalytics();
            loadDarkMode();
            document.getElementById('userName').textContent = currentUser;
            
            // Set MRR values
            document.getElementById('mrr').value = data.settings.currentMRR;
            document.getElementById('mrrGoal').value = data.settings.mrrGoal;
            document.getElementById('signedGoal').textContent = data.settings.signedGoal;
        }

        // NAVIGATION
        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById(pageName).classList.remove('hidden');
            
            if (pageName === 'projects') loadProjects();
            if (pageName === 'tasks') loadTasks();
            if (pageName === 'features') loadFeatures();
            if (pageName === 'analytics') loadAnalytics();
        }

        // NOTIFICATIONS
        function loadNotifications() {
            const list = document.getElementById('notificationsList');
            if (data.notifications.length === 0) {
                list.innerHTML = '<div class="p-3 text-center text-gray-500 text-sm">Aucune notification</div>';
                document.getElementById('notifBadge').classList.add('hidden');
                return;
            }
            
            list.innerHTML = data.notifications.map(n => `
                <div class="p-3 hover:bg-gray-50">
                    <div class="flex items-start">
                        <span class="mr-2">${n.type === 'warning' ? '‚ö†Ô∏è' : n.type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è'}</span>
                        <div class="flex-1">
                            <div class="text-sm">${n.message}</div>
                            <div class="text-xs text-gray-500 mt-1">${n.time}</div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('notifBadge').classList.remove('hidden');
            document.getElementById('notifBadge').textContent = data.notifications.length;
        }

        function toggleNotifications() {
            const panel = document.getElementById('notificationsPanel');
            panel.classList.toggle('hidden');
        }

        // DASHBOARD
        function loadDashboard() {
            const activeProjects = document.getElementById('activeProjects');
            activeProjects.innerHTML = data.projects.filter(p => p.status === 'active' || p.status === 'demo').map(p => `
                <div class="p-4 hover:bg-gray-50 cursor-pointer" onclick="viewProjectDetail(${p.id})">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h3 class="font-semibold">${getProjectIcon(p.name)} ${p.name}</h3>
                            <span class="text-xs text-gray-500">Phase ${p.phase} | ${p.progress}%</span>
                        </div>
                        <span class="px-2 py-1 text-xs rounded ${getStatusColor(p.status)}">${getStatusText(p.status)}</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2 mb-2">
                        <div class="bg-blue-600 h-2 rounded-full phase-progress" style="width: ${p.progress}%"></div>
                    </div>
                    <div class="flex justify-between text-xs text-gray-600">
                        <span>üë§ ${p.assignee}</span>
                        <span>üí∞ ${p.revenue}‚Ç¨/mois</span>
                    </div>
                </div>
            `).join('');

            const urgentTasks = document.getElementById('urgentTasks');
            const urgent = data.tasks.filter(t => (t.priority === 'urgent' || t.priority === 'high') && t.status !== 'done').slice(0, 5);
            urgentTasks.innerHTML = urgent.length > 0 ? urgent.map(t => {
                const project = data.projects.find(p => p.id === t.projectId);
                return `
                    <div class="border-l-4 ${getPriorityColor(t.priority)} pl-3 py-2 bg-gray-50 rounded cursor-pointer hover:bg-gray-100" onclick="editTask(${t.id})">
                        <div class="font-medium text-sm">${t.title}</div>
                        <div class="text-xs text-gray-600 mt-1">${project.name} ‚Ä¢ ${t.assignee}</div>
                    </div>
                `;
            }).join('') : '<div class="text-gray-500 text-sm">Aucune t√¢che prioritaire</div>';

            // Update KPIs
            document.getElementById('signedRestaurants').textContent = data.projects.filter(p => p.status === 'active').length;
            
            const completed = data.tasks.filter(t => t.status === 'done').length;
            const total = data.tasks.length;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('totalTasks').textContent = total;
            document.getElementById('completionPercent').textContent = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            const ongoing = data.tasks.filter(t => t.status === 'doing').length;
            document.getElementById('ongoingTasks').textContent = ongoing;
        }

        // PROJECTS
        function loadProjects() {
            const projectsList = document.getElementById('projectsList');
            projectsList.innerHTML = data.projects.map(p => `
                <div class="bg-white rounded-lg shadow p-4 hover:shadow-lg transition cursor-pointer" onclick="viewProjectDetail(${p.id})">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-bold text-lg">${getProjectIcon(p.name)} ${p.name}</h3>
                        <span class="px-2 py-1 text-xs rounded ${getStatusColor(p.status)}">${getStatusText(p.status)}</span>
                    </div>
                    <div class="text-sm text-gray-600 space-y-1 mb-3">
                        <div>üìß ${p.contact}</div>
                        <div>üì± ${p.phone}</div>
                        <div>üë§ Responsable: ${p.assignee}</div>
                    </div>
                    <div class="border-t pt-3">
                        <div class="flex justify-between text-sm mb-2">
                            <span>Phase ${p.phase}/4</span>
                            <span class="font-semibold">${p.progress}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full" style="width: ${p.progress}%"></div>
                        </div>
                        <div class="mt-2 text-right">
                            <span class="text-green-600 font-bold">${p.revenue}‚Ç¨/mois</span>
                        </div>
                    </div>
                </div>
            `).join('');

            const taskProjectSelect = document.getElementById('newTaskProject');
            taskProjectSelect.innerHTML = '<option value="">S√©lectionner un projet</option>' + 
                data.projects.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
        }

        function viewProjectDetail(id) {
            currentProjectId = id;
            const project = data.projects.find(p => p.id === id);
            const projectTasks = data.tasks.filter(t => t.projectId === id);
            
            document.getElementById('modalProjectName').textContent = getProjectIcon(project.name) + ' ' + project.name;
            document.getElementById('modalPhase').textContent = `${project.phase}/4`;
            document.getElementById('modalProgress').textContent = `${project.progress}%`;
            document.getElementById('modalRevenue').textContent = `${project.revenue}‚Ç¨`;
            document.getElementById('modalEmail').textContent = project.contact;
            document.getElementById('modalPhone').textContent = project.phone;
            document.getElementById('modalAssignee').textContent = project.assignee;
            document.getElementById('modalStatus').textContent = getStatusText(project.status);
            
            document.getElementById('modalTasks').innerHTML = projectTasks.length > 0 ? projectTasks.map(t => `
                <div class="flex items-center justify-between p-2 bg-gray-50 rounded border-l-4 ${getPriorityColor(t.priority)}">
                    <div class="flex-1">
                        <div class="font-medium text-sm">${t.title}</div>
                        <div class="text-xs text-gray-500">${t.assignee}</div>
                    </div>
                    <span class="px-2 py-1 text-xs rounded ${getTaskStatusColor(t.status)}">${getTaskStatusText(t.status)}</span>
                </div>
            `).join('') : '<div class="text-gray-500 text-sm">Aucune t√¢che pour ce projet</div>';
            
            const featureObjs = data.features.filter(f => project.features.includes(f.id));
            document.getElementById('modalFeatures').innerHTML = featureObjs.map(f => 
                `<span class="px-3 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">${f.icon} ${f.name}</span>`
            ).join('');
            
            document.getElementById('projectDetailModal').classList.remove('hidden');
        }

        function closeProjectDetailModal() {
            document.getElementById('projectDetailModal').classList.add('hidden');
            currentProjectId = null;
        }

        function editProjectFromDetail() {
            const project = data.projects.find(p => p.id === currentProjectId);
            if (!project) return;
            
            document.getElementById('projectModalTitle').textContent = '‚úèÔ∏è Modifier le Restaurant';
            document.getElementById('editProjectId').value = project.id;
            document.getElementById('newProjectName').value = project.name;
            document.getElementById('newProjectContact').value = project.contact;
            document.getElementById('newProjectPhone').value = project.phone;
            document.getElementById('newProjectStatus').value = project.status;
            document.getElementById('newProjectRevenue').value = project.revenue;
            document.getElementById('newProjectAssignee').value = project.assignee;
            document.getElementById('newProjectPhase').value = project.phase;
            document.getElementById('newProjectProgress').value = project.progress;
            
            loadProjectFeaturesCheckboxes(project.features);
            
            closeProjectDetailModal();
            document.getElementById('projectModal').classList.remove('hidden');
        }

        function deleteProjectConfirm() {
            if (!currentProjectId) return;
            const project = data.projects.find(p => p.id === currentProjectId);
            
            if (confirm(`√ätes-vous s√ªr de vouloir supprimer le projet "${project.name}" ?\n\nCette action est irr√©versible et supprimera aussi toutes les t√¢ches associ√©es.`)) {
                data.projects = data.projects.filter(p => p.id !== currentProjectId);
                data.tasks = data.tasks.filter(t => t.projectId !== currentProjectId);
                
                closeProjectDetailModal();
                loadProjects();
                loadDashboard();
                loadTasks();
                saveData();
                addNotification('success', `Projet "${project.name}" supprim√©`, 'Maintenant');
            }
        }

        // TASKS
        function loadTasks() {
            const columns = {todo: [], doing: [], blocked: [], done: []};
            data.tasks.forEach(t => columns[t.status].push(t));

            Object.keys(columns).forEach(status => {
                const col = document.getElementById(status + 'Column');
                const count = document.getElementById(status + 'Count');
                if (count) count.textContent = columns[status].length;
                
                col.innerHTML = columns[status].map(t => {
                    const project = data.projects.find(p => p.id === t.projectId);
                    return `
                        <div class="task-card bg-white p-3 rounded shadow-sm border-l-4 ${getPriorityColor(t.priority)} cursor-pointer" onclick="editTask(${t.id})">
                            <div class="font-semibold text-sm mb-1">${t.title}</div>
                            <div class="text-xs text-gray-600 mb-2">${project ? project.name : 'Sans projet'}</div>
                            <div class="flex justify-between items-center text-xs">
                                <span class="px-2 py-0.5 bg-gray-100 rounded">${t.assignee}</span>
                            </div>
                            <div class="mt-2 text-xs text-gray-500">üéØ ${t.goal}</div>
                        </div>
                    `;
                }).join('');
            });
        }

        function filterTasks(status) {
            if (status === 'all') {
                document.querySelectorAll('#tasksBoard > div').forEach(col => col.style.display = 'block');
            } else {
                Object.keys({todo: 1, doing: 1, blocked: 1, done: 1}).forEach(s => {
                    const col = document.getElementById(s + 'Column').parentElement;
                    col.style.display = s === status ? 'block' : 'none';
                });
            }
        }

        function editTask(id) {
            const task = data.tasks.find(t => t.id === id);
            const statuses = ['√Ä faire', 'En cours', 'Bloqu√©e', 'Termin√©e'];
            const newStatus = prompt(`Modifier le statut de "${task.title}":\n\n1. ${statuses[0]}\n2. ${statuses[1]}\n3. ${statuses[2]}\n4. ${statuses[3]}\n\nEntrez le num√©ro:`);
            const statusMap = {1: 'todo', 2: 'doing', 3: 'blocked', 4: 'done'};
            if (statusMap[newStatus]) {
                task.status = statusMap[newStatus];
                loadTasks();
                loadDashboard();
                saveData();
                addNotification('success', `T√¢che "${task.title}" mise √† jour`, 'Maintenant');
            }
        }

        // FEATURES
        function loadFeatures() {
            const featuresList = document.getElementById('featuresList');
            featuresList.innerHTML = data.features.map(f => `
                <div class="bg-white rounded-lg shadow p-4 border-l-4 ${f.type === 'included' ? 'border-green-500' : 'border-yellow-500'}">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-bold text-lg">${f.icon} ${f.name}</h3>
                        <button onclick="deleteFeature(${f.id})" class="text-red-500 hover:text-red-700 text-sm">üóëÔ∏è</button>
                    </div>
                    <p class="text-sm text-gray-600 mb-3">${f.desc}</p>
                    <span class="text-xs ${f.type === 'included' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'} px-2 py-1 rounded">
                        ${f.type === 'included' ? 'Inclus' : `+${f.price}‚Ç¨/mois`}
                    </span>
                </div>
            `).join('');
        }

        function loadProjectFeaturesCheckboxes(selectedFeatures = []) {
            const container = document.getElementById('projectFeaturesCheckboxes');
            container.innerHTML = data.features.map(f => `
                <label class="flex items-center space-x-2 cursor-pointer hover:bg-white p-1 rounded">
                    <input type="checkbox" value="${f.id}" ${selectedFeatures.includes(f.id) ? 'checked' : ''} class="feature-checkbox">
                    <span class="text-sm">${f.icon} ${f.name}</span>
                </label>
            `).join('');
        }

        function openFeatureModal() {
            document.getElementById('featureModal').classList.remove('hidden');
        }

        function closeFeatureModal() {
            document.getElementById('featureModal').classList.add('hidden');
        }

        function createFeature() {
            const name = document.getElementById('newFeatureName').value;
            const icon = document.getElementById('newFeatureIcon').value;
            const desc = document.getElementById('newFeatureDesc').value;
            const type = document.getElementById('newFeatureType').value;
            const price = parseInt(document.getElementById('newFeaturePrice').value) || 0;

            if (!name) {
                alert('‚ö†Ô∏è Nom obligatoire');
                return;
            }

            const newId = Math.max(...data.features.map(f => f.id), 0) + 1;
            data.features.push({ id: newId, name, icon: icon || '‚öôÔ∏è', desc, type, price });

            closeFeatureModal();
            loadFeatures();
            saveData();
            addNotification('success', `Feature "${name}" cr√©√©e`, 'Maintenant');
            
            document.getElementById('newFeatureName').value = '';
            document.getElementById('newFeatureIcon').value = '';
            document.getElementById('newFeatureDesc').value = '';
            document.getElementById('newFeaturePrice').value = '';
        }

        function deleteFeature(id) {
            const feature = data.features.find(f => f.id === id);
            if (confirm(`Supprimer la feature "${feature.name}" ?`)) {
                data.features = data.features.filter(f => f.id !== id);
                loadFeatures();
                saveData();
                addNotification('success', `Feature "${feature.name}" supprim√©e`, 'Maintenant');
            }
        }

        // ANALYTICS
        function loadAnalytics() {
            document.getElementById('analyticsYearRevenue').textContent = data.analytics.yearRevenue;
            document.getElementById('analyticsYearGrowth').textContent = data.analytics.yearGrowth;
            document.getElementById('analyticsTimeSaved').textContent = data.analytics.timeSaved;
            document.getElementById('analyticsActiveClients').textContent = data.projects.filter(p => p.status === 'active').length;
            document.getElementById('analyticsConversionRate').textContent = data.analytics.conversionRate;

            // Contract sizes
            const contractSizeList = document.getElementById('contractSizeList');
            contractSizeList.innerHTML = data.contracts.map(c => `
                <div class="flex items-center justify-between p-3 border rounded hover:bg-gray-50">
                    <div class="flex-1">
                        <div class="font-semibold">${c.name}</div>
                        <div class="text-xs text-gray-500">${c.desc}</div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <span class="font-bold text-lg text-${c.color}-600">${c.price}‚Ç¨/mois</span>
                        <button onclick="deleteContract(${c.id})" class="text-red-500 hover:text-red-700">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');

            // Revenue breakdown
            const revenues = data.projects.map(p => {
                const contract = data.contracts.find(c => c.price === p.revenue);
                return { name: contract ? contract.name : 'Personnalis√©', revenue: p.revenue };
            });

            const breakdown = {};
            revenues.forEach(r => {
                breakdown[r.name] = (breakdown[r.name] || 0) + r.revenue;
            });

            const revenueByContractType = document.getElementById('revenueByContractType');
            revenueByContractType.innerHTML = Object.entries(breakdown).map(([name, total]) => `
                <div class="flex justify-between items-center text-sm">
                    <span>${name}:</span>
                    <span class="font-bold">${total}‚Ç¨/mois</span>
                </div>
            `).join('');

            // Stats
            const activeRevenues = data.projects.filter(p => p.status === 'active').map(p => p.revenue);
            if (activeRevenues.length > 0) {
                const avg = Math.round(activeRevenues.reduce((a, b) => a + b, 0) / activeRevenues.length);
                const max = Math.max(...activeRevenues);
                const min = Math.min(...activeRevenues);
                document.getElementById('avgContract').textContent = avg;
                document.getElementById('maxContract').textContent = max;
                document.getElementById('minContract').textContent = min;
            }
        }

        function openAnalyticsModal() {
            document.getElementById('editYearRevenue').value = data.analytics.yearRevenue;
            document.getElementById('editYearGrowth').value = data.analytics.yearGrowth;
            document.getElementById('editTimeSaved').value = data.analytics.timeSaved;
            document.getElementById('editConversionRate').value = data.analytics.conversionRate;
            document.getElementById('analyticsModal').classList.remove('hidden');
        }

        function closeAnalyticsModal() {
            document.getElementById('analyticsModal').classList.add('hidden');
        }

        function saveAnalytics() {
            data.analytics.yearRevenue = parseInt(document.getElementById('editYearRevenue').value) || 0;
            data.analytics.yearGrowth = parseInt(document.getElementById('editYearGrowth').value) || 0;
            data.analytics.timeSaved = parseInt(document.getElementById('editTimeSaved').value) || 0;
            data.analytics.conversionRate = parseInt(document.getElementById('editConversionRate').value) || 0;
            
            closeAnalyticsModal();
            loadAnalytics();
            saveData();
            addNotification('success', 'M√©triques analytics mises √† jour', 'Maintenant');
        }

        function openContractModal() {
            document.getElementById('contractModal').classList.remove('hidden');
        }

        function closeContractModal() {
            document.getElementById('contractModal').classList.add('hidden');
        }

        function createContract() {
            const name = document.getElementById('newContractName').value;
            const price = parseInt(document.getElementById('newContractPrice').value);
            const desc = document.getElementById('newContractDesc').value;
            const color = document.getElementById('newContractColor').value;

            if (!name || !price) {
                alert('‚ö†Ô∏è Nom et prix obligatoires');
                return;
            }

            const newId = Math.max(...data.contracts.map(c => c.id), 0) + 1;
            data.contracts.push({ id: newId, name, price, desc, color });

            closeContractModal();
            loadAnalytics();
            saveData();
            addNotification('success', `Contrat "${name}" cr√©√©`, 'Maintenant');
            
            document.getElementById('newContractName').value = '';
            document.getElementById('newContractPrice').value = '';
            document.getElementById('newContractDesc').value = '';
        }

        function deleteContract(id) {
            const contract = data.contracts.find(c => c.id === id);
            if (confirm(`Supprimer le contrat "${contract.name}" ?`)) {
                data.contracts = data.contracts.filter(c => c.id !== id);
                loadAnalytics();
                saveData();
                addNotification('success', `Contrat "${contract.name}" supprim√©`, 'Maintenant');
            }
        }

        // AI ASSISTANT
        function openAI() {
            showPage('ai');
        }

        function askAI(type) {
            const responses = {
                priorities: "üìã Voici tes priorit√©s:\n\n" + data.tasks.filter(t => t.status !== 'done').slice(0, 3).map((t, i) => `${i+1}. ${t.title} (${t.priority})`).join('\n'),
                script: "üìû Script de vente g√©n√©r√© avec succ√®s!",
                objection: "üé≠ Voici comment g√©rer l'objection 'trop cher'...",
                email: "üìß Email de prospection pr√™t!"
            };
            
            addAIMessage('user', type);
            setTimeout(() => addAIMessage('ai', responses[type]), 500);
        }

        function sendAIMessage() {
            const input = document.getElementById('aiInput');
            const msg = input.value.trim();
            if (!msg) return;
            
            addAIMessage('user', msg);
            input.value = '';
            
            setTimeout(() => {
                addAIMessage('ai', 'Traitement en cours...');
            }, 500);
        }

        function addAIMessage(type, text) {
            const chat = document.getElementById('chatMessages');
            const div = document.createElement('div');
            div.className = type === 'user' ? 'bg-gray-100 p-3 rounded-lg text-right' : 'bg-blue-50 p-3 rounded-lg';
            div.innerHTML = `<strong>${type === 'user' ? 'üë§' : 'ü§ñ'}</strong> ${text}`;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        // MODALS
        function openProjectModal() {
            document.getElementById('projectModalTitle').textContent = 'üçΩÔ∏è Nouveau Restaurant';
            document.getElementById('editProjectId').value = '';
            document.getElementById('newProjectName').value = '';
            document.getElementById('newProjectContact').value = '';
            document.getElementById('newProjectPhone').value = '';
            document.getElementById('newProjectStatus').value = 'prospect';
            document.getElementById('newProjectRevenue').value = '';
            document.getElementById('newProjectAssignee').value = 'Marc';
            document.getElementById('newProjectPhase').value = '1';
            document.getElementById('newProjectProgress').value = '0';
            loadProjectFeaturesCheckboxes([]);
            document.getElementById('projectModal').classList.remove('hidden');
        }

        function closeProjectModal() {
            document.getElementById('projectModal').classList.add('hidden');
        }

        function saveProject() {
            const editId = document.getElementById('editProjectId').value;
            const name = document.getElementById('newProjectName').value;
            const contact = document.getElementById('newProjectContact').value;
            const phone = document.getElementById('newProjectPhone').value;
            const status = document.getElementById('newProjectStatus').value;
            const revenue = parseInt(document.getElementById('newProjectRevenue').value) || 0;
            const assignee = document.getElementById('newProjectAssignee').value;
            const phase = parseInt(document.getElementById('newProjectPhase').value);
            const progress = parseInt(document.getElementById('newProjectProgress').value) || 0;
            
            const selectedFeatures = Array.from(document.querySelectorAll('.feature-checkbox:checked')).map(cb => parseInt(cb.value));

            if (!name || !contact) {
                alert('‚ö†Ô∏è Nom et email obligatoires');
                return;
            }

            if (editId) {
                const project = data.projects.find(p => p.id === parseInt(editId));
                if (project) {
                    project.name = name;
                    project.contact = contact;
                    project.phone = phone;
                    project.status = status;
                    project.revenue = revenue;
                    project.assignee = assignee;
                    project.phase = phase;
                    project.progress = progress;
                    project.features = selectedFeatures;
                    addNotification('success', `Restaurant "${name}" modifi√©`, 'Maintenant');
                }
            } else {
                const newId = Math.max(...data.projects.map(p => p.id), 0) + 1;
                data.projects.push({
                    id: newId, name, contact, phone, status, revenue, phase, progress, assignee,
                    features: selectedFeatures
                });
                addNotification('success', `Restaurant "${name}" cr√©√©`, 'Maintenant');
            }

            closeProjectModal();
            loadProjects();
            loadDashboard();
            loadAnalytics();
            saveData();
        }

        function openTaskModal() {
            document.getElementById('taskModal').classList.remove('hidden');
        }

        function closeTaskModal() {
            document.getElementById('taskModal').classList.add('hidden');
        }

        function createTask() {
            const title = document.getElementById('newTaskTitle').value;
            const desc = document.getElementById('newTaskDesc').value;
            const projectId = parseInt(document.getElementById('newTaskProject').value);
            const phase = parseInt(document.getElementById('newTaskPhase').value);
            const assignee = document.getElementById('newTaskAssignee').value;
            const priority = document.getElementById('newTaskPriority').value;
            const deadline = document.getElementById('newTaskDeadline').value;
            const goal = document.getElementById('newTaskGoal').value;

            if (!title || !projectId || !deadline) {
                alert('‚ö†Ô∏è Titre, projet et deadline obligatoires');
                return;
            }

            const newId = Math.max(...data.tasks.map(t => t.id), 0) + 1;
            data.tasks.push({
                id: newId, projectId, title, desc, phase, assignee,
                status: 'todo', priority, deadline, goal
            });

            closeTaskModal();
            loadTasks();
            loadDashboard();
            saveData();
            addNotification('success', `T√¢che "${title}" cr√©√©e`, 'Maintenant');
            
            document.getElementById('newTaskTitle').value = '';
            document.getElementById('newTaskDesc').value = '';
            document.getElementById('newTaskDeadline').value = '';
            document.getElementById('newTaskGoal').value = '';
        }

        // UTILITIES
        function getProjectIcon(name) {
            if (name.toLowerCase().includes('bella')) return 'üçï';
            if (name.toLowerCase().includes('sushi')) return 'üç£';
            if (name.toLowerCase().includes('gourmet')) return 'üç∑';
            return 'üçΩÔ∏è';
        }

        function getStatusColor(status) {
            const colors = {
                prospect: 'bg-gray-200 text-gray-700',
                demo: 'bg-yellow-200 text-yellow-800',
                active: 'bg-green-200 text-green-800',
                churned: 'bg-red-200 text-red-800'
            };
            return colors[status] || 'bg-gray-200';
        }

        function getStatusText(status) {
            const texts = { prospect: 'Prospect', demo: 'D√©mo', active: 'Actif', churned: 'Inactif' };
            return texts[status] || status;
        }

        function getTaskStatusColor(status) {
            const colors = {
                todo: 'bg-gray-200 text-gray-700',
                doing: 'bg-blue-200 text-blue-800',
                blocked: 'bg-red-200 text-red-800',
                done: 'bg-green-200 text-green-800'
            };
            return colors[status] || 'bg-gray-200';
        }

        function getTaskStatusText(status) {
            const texts = { todo: '√Ä faire', doing: 'En cours', blocked: 'Bloqu√©e', done: 'Termin√©e' };
            return texts[status] || status;
        }

        function getPriorityColor(priority) {
            const colors = { low: 'border-gray-300', medium: 'border-blue-400', high: 'border-orange-400', urgent: 'border-red-500' };
            return colors[priority] || 'border-gray-300';
        }

        function addNotification(type, message, time) {
            const newId = Math.max(...data.notifications.map(n => n.id), 0) + 1;
            data.notifications.unshift({id: newId, type, message, time});
            if (data.notifications.length > 10) data.notifications.pop();
            loadNotifications();
        }

        function logout() {
            if (confirm('D√©connexion ?')) {
                alert('√Ä bient√¥t !');
            }
        }

        // PERSISTENCE
        function saveData() {
            try {
                localStorage.setItem('restaurantOS_data', JSON.stringify(data));
            } catch (e) {
                console.error('Erreur sauvegarde:', e);
            }
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('restaurantOS_data');
                if (saved) {
                    const savedData = JSON.parse(saved);
                    data = { ...data, ...savedData };
                }
            } catch (e) {
                console.error('Erreur chargement:', e);
            }
        }

        setInterval(saveData, 5000);

        document.addEventListener('click', (e) => {
            const panel = document.getElementById('notificationsPanel');
            const btn = e.target.closest('button[onclick="toggleNotifications()"]');
            if (!panel.contains(e.target) && !btn && !panel.classList.contains('hidden')) {
                panel.classList.add('hidden');
            }
        });

        window.addEventListener('DOMContentLoaded', () => {
            loadData();
            init();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('newTaskDeadline').value = today;
        });
    </script>
</body>
</html>
