<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RestaurantOS - Plateforme de Gestion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyDOXDHOQj2cADZ9ai2uHzQ1lE8HsX3P3Hg",
            authDomain: "restaurantos-7bf0a.firebaseapp.com",
            databaseURL: "https://restaurantos-7bf0a-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "restaurantos-7bf0a",
            storageBucket: "restaurantos-7bf0a.firebasestorage.app",
            messagingSenderId: "501432201588",
            appId: "1:501432201588:web:3720005ca099406dab3c21"
        };
        
        try {
            const app = initializeApp(firebaseConfig);
            const database = getDatabase(app);
            window.firebaseDB = database;
            window.firebaseRef = ref;
            window.firebaseSet = set;
            window.firebaseGet = get;
            console.log('‚úÖ Firebase pr√™t');
        } catch (e) {
            console.warn('‚ö†Ô∏è Firebase non disponible, mode local activ√©');
        }
        
        window.addEventListener('load', () => {
            setTimeout(() => window.initApp && window.initApp(), 500);
        });
    </script>
    
    <style>
        .dark { background-color: #0f172a !important; color: #e2e8f0 !important; }
        .dark body { background-color: #0f172a !important; }
        .dark .bg-white { background-color: #1e293b !important; color: #e2e8f0 !important; }
        .dark .bg-gray-50 { background-color: #0f172a !important; }
        .dark .bg-gray-100 { background-color: #334155 !important; }
        .dark .text-gray-600 { color: #94a3b8 !important; }
        .dark .text-gray-700 { color: #cbd5e1 !important; }
        .dark .text-gray-900 { color: #f1f5f9 !important; }
        .dark input, .dark textarea, .dark select {
            background-color: #334155 !important;
            color: #e2e8f0 !important;
            border-color: #475569 !important;
        }
        .task-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .task-card { transition: all 0.2s ease; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <h1 class="text-xl font-bold text-blue-600">üçΩÔ∏è RestaurantOS</h1>
                <div class="flex items-center space-x-3">
                    <button onclick="toggleDarkMode()" class="p-2 hover:bg-gray-100 rounded">
                        <span id="darkModeIcon">üåô</span>
                    </button>
                    <button onclick="toggleNotifications()" class="relative p-2 hover:bg-gray-100 rounded">
                        üîî
                        <span id="notifBadge" class="hidden absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
                    </button>
                    <span class="text-sm text-gray-600 dark:text-gray-400">üë§ Stephen</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Notifications -->
    <div id="notificationsPanel" class="hidden fixed right-4 top-16 w-80 bg-white dark:bg-gray-800 rounded-lg shadow-xl border z-50 max-h-96 overflow-y-auto">
        <div class="p-4 border-b sticky top-0 bg-white dark:bg-gray-800">
            <div class="flex justify-between items-center">
                <h3 class="font-semibold dark:text-white">Notifications</h3>
                <button onclick="clearAllNotifications()" class="text-xs text-red-600">Tout effacer</button>
            </div>
        </div>
        <div id="notificationsList" class="divide-y"></div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="page max-w-7xl mx-auto px-4 py-6">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
                <div class="text-sm text-gray-600 dark:text-gray-400">Restaurants sign√©s</div>
                <div class="flex items-center justify-center space-x-2 mt-2">
                    <button onclick="changeSignedRestaurants(-1)" class="w-8 h-8 bg-red-500 text-white rounded hover:bg-red-600">‚àí</button>
                    <div class="text-2xl font-bold text-blue-600"><span id="signedRestaurants">0</span>/<span id="signedGoal">5</span></div>
                    <button onclick="changeSignedRestaurants(1)" class="w-8 h-8 bg-green-500 text-white rounded hover:bg-green-600">+</button>
                </div>
            </div>
            
            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
                <div class="text-sm text-gray-600 dark:text-gray-400">Revenu MRR</div>
                <div class="text-2xl font-bold text-green-600 text-center mt-2"><span id="totalMRR">0</span>‚Ç¨</div>
            </div>
            
            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
                <div class="text-sm text-gray-600 dark:text-gray-400">T√¢ches compl√©t√©es</div>
                <div class="text-2xl font-bold text-purple-600 text-center mt-2">
                    <span id="completedTasks">0</span>/<span id="totalTasks">0</span>
                </div>
            </div>
            
            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
                <div class="text-sm text-gray-600 dark:text-gray-400">Projets actifs</div>
                <div class="text-2xl font-bold text-orange-600 text-center mt-2"><span id="activeProjectsCount">0</span></div>
            </div>
        </div>

        <div class="grid md:grid-cols-2 gap-4">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow">
                <div class="p-4 border-b dark:border-gray-700 flex justify-between items-center">
                    <h2 class="text-lg font-semibold dark:text-white">üìÅ Projets</h2>
                    <button onclick="openProjectModal()" class="text-sm bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">+ Nouveau</button>
                </div>
                <div id="projectsList" class="p-4 space-y-2 max-h-96 overflow-y-auto"></div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-lg shadow">
                <div class="p-4 border-b dark:border-gray-700 flex justify-between items-center">
                    <h2 class="text-lg font-semibold dark:text-white">‚úÖ T√¢ches</h2>
                    <button onclick="openTaskModal()" class="text-sm bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">+ Nouvelle</button>
                </div>
                <div id="tasksList" class="p-4 space-y-2 max-h-96 overflow-y-auto"></div>
            </div>
        </div>
    </div>

    <!-- Project Modal -->
    <div id="projectModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
            <h3 id="projectModalTitle" class="text-xl font-bold mb-4 dark:text-white">üçΩÔ∏è Nouveau Restaurant</h3>
            <div class="space-y-3">
                <input id="editProjectId" type="hidden">
                <input id="newProjectName" type="text" placeholder="Nom du restaurant *" class="w-full border rounded px-3 py-2">
                <input id="newProjectContact" type="email" placeholder="Email *" class="w-full border rounded px-3 py-2">
                <input id="newProjectPhone" type="tel" placeholder="T√©l√©phone" class="w-full border rounded px-3 py-2">
                <input id="newProjectRevenue" type="number" placeholder="Revenu mensuel (‚Ç¨)" class="w-full border rounded px-3 py-2">
                <textarea id="newProjectNotes" placeholder="Notes..." class="w-full border rounded px-3 py-2 h-20"></textarea>
            </div>
            <div class="flex space-x-2 mt-4">
                <button onclick="closeProjectModal()" class="flex-1 border rounded py-2 dark:text-white">Annuler</button>
                <button onclick="saveProject()" class="flex-1 bg-blue-600 text-white rounded py-2 hover:bg-blue-700">Enregistrer</button>
            </div>
            <button id="deleteProjectBtn" onclick="deleteCurrentProject()" class="hidden w-full mt-2 bg-red-600 text-white rounded py-2 hover:bg-red-700">üóëÔ∏è Supprimer</button>
        </div>
    </div>

    <!-- Task Modal -->
    <div id="taskModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
            <h3 id="taskModalTitle" class="text-xl font-bold mb-4 dark:text-white">‚ûï Nouvelle T√¢che</h3>
            <div class="space-y-3">
                <input id="editTaskId" type="hidden">
                <input id="newTaskTitle" type="text" placeholder="Titre *" class="w-full border rounded px-3 py-2">
                <textarea id="newTaskDesc" placeholder="Description" class="w-full border rounded px-3 py-2 h-20"></textarea>
                <select id="newTaskProject" class="w-full border rounded px-3 py-2">
                    <option value="">S√©lectionner un projet</option>
                </select>
                <select id="newTaskAssignee" class="w-full border rounded px-3 py-2">
                    <option value="Stephen">Stephen</option>
                    <option value="Eva">Eva</option>
                </select>
                <select id="newTaskPriority" class="w-full border rounded px-3 py-2">
                    <option value="low">üü¢ Basse</option>
                    <option value="medium">üü° Moyenne</option>
                    <option value="high">üü† Haute</option>
                    <option value="urgent">üî¥ Urgente</option>
                </select>
                <select id="newTaskStatus" class="w-full border rounded px-3 py-2">
                    <option value="todo">üìù √Ä faire</option>
                    <option value="doing">üîÑ En cours</option>
                    <option value="blocked">‚ö†Ô∏è Bloqu√©e</option>
                    <option value="done">‚úÖ Termin√©e</option>
                </select>
                <input id="newTaskDeadline" type="date" class="w-full border rounded px-3 py-2">
            </div>
            <div class="flex space-x-2 mt-4">
                <button onclick="closeTaskModal()" class="flex-1 border rounded py-2 dark:text-white">Annuler</button>
                <button onclick="saveTask()" class="flex-1 bg-blue-600 text-white rounded py-2 hover:bg-blue-700">Enregistrer</button>
            </div>
            <button id="deleteTaskBtn" onclick="deleteCurrentTask()" class="hidden w-full mt-2 bg-red-600 text-white rounded py-2 hover:bg-red-700">üóëÔ∏è Supprimer</button>
        </div>
    </div>

    <script>
        let data = {
            settings: { signedRestaurants: 0, signedGoal: 5, currentMRR: 0, darkMode: true },
            projects: [],
            tasks: [],
            notifications: []
        };

        // Firebase save/load
        async function saveToFirebase() {
            if (!window.firebaseDB) return;
            try {
                const dbRef = window.firebaseRef(window.firebaseDB, 'restaurantOS');
                await window.firebaseSet(dbRef, data);
                console.log('‚úÖ Sauvegard√© dans Firebase');
            } catch (e) {
                console.warn('‚ö†Ô∏è Firebase save error:', e);
            }
        }

        async function loadFromFirebase() {
            if (!window.firebaseDB) return false;
            try {
                const dbRef = window.firebaseRef(window.firebaseDB, 'restaurantOS');
                const snapshot = await window.firebaseGet(dbRef);
                if (snapshot.exists()) {
                    data = snapshot.val();
                    console.log('‚úÖ Charg√© depuis Firebase');
                    return true;
                }
            } catch (e) {
                console.warn('‚ö†Ô∏è Firebase load error:', e);
            }
            return false;
        }

        // Dark mode
        function toggleDarkMode() {
            data.settings.darkMode = !data.settings.darkMode;
            document.body.classList.toggle('dark', data.settings.darkMode);
            document.getElementById('darkModeIcon').textContent = data.settings.darkMode ? '‚òÄÔ∏è' : 'üåô';
            saveToFirebase();
        }

        // Signed restaurants
        function changeSignedRestaurants(delta) {
            data.settings.signedRestaurants = Math.max(0, Math.min(99, data.settings.signedRestaurants + delta));
            updateUI();
            saveToFirebase();
        }

        // Notifications
        function toggleNotifications() {
            document.getElementById('notificationsPanel').classList.toggle('hidden');
        }

        function addNotification(message) {
            data.notifications.unshift({ message, time: new Date().toLocaleTimeString('fr-FR') });
            if (data.notifications.length > 20) data.notifications.pop();
            loadNotifications();
            saveToFirebase();
        }

        function loadNotifications() {
            const list = document.getElementById('notificationsList');
            const badge = document.getElementById('notifBadge');
            
            if (data.notifications.length === 0) {
                list.innerHTML = '<div class="p-3 text-center text-gray-500 text-sm">Aucune notification</div>';
                badge.classList.add('hidden');
            } else {
                list.innerHTML = data.notifications.map((n, i) => `
                    <div class="p-3 hover:bg-gray-50 dark:hover:bg-gray-700 flex justify-between items-start">
                        <div class="flex-1">
                            <div class="text-sm dark:text-white">${n.message}</div>
                            <div class="text-xs text-gray-500 mt-1">${n.time}</div>
                        </div>
                        <button onclick="deleteNotification(${i})" class="ml-2 text-red-500">‚úï</button>
                    </div>
                `).join('');
                badge.classList.remove('hidden');
                badge.textContent = data.notifications.length;
            }
        }

        function deleteNotification(index) {
            data.notifications.splice(index, 1);
            loadNotifications();
            saveToFirebase();
        }

        function clearAllNotifications() {
            if (confirm('Effacer toutes les notifications ?')) {
                data.notifications = [];
                loadNotifications();
                saveToFirebase();
            }
        }

        // Projects
        function loadProjects() {
            const list = document.getElementById('projectsList');
            const select = document.getElementById('newTaskProject');
            
            if (data.projects.length === 0) {
                list.innerHTML = '<div class="text-gray-500 text-sm text-center py-4">Aucun projet</div>';
                select.innerHTML = '<option value="">Aucun projet disponible</option>';
            } else {
                list.innerHTML = data.projects.map(p => `
                    <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded border-l-4 border-blue-500 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600" onclick="editProject('${p.id}')">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="font-semibold dark:text-white">${p.name}</div>
                                <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">${p.contact}</div>
                                ${p.revenue ? `<div class="text-xs text-green-600 dark:text-green-400 mt-1">üí∞ ${p.revenue}‚Ç¨/mois</div>` : ''}
                            </div>
                            <button onclick="event.stopPropagation(); deleteProject('${p.id}')" class="text-red-500 hover:text-red-700 ml-2">üóëÔ∏è</button>
                        </div>
                    </div>
                `).join('');
                
                select.innerHTML = '<option value="">S√©lectionner un projet</option>' + 
                    data.projects.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
            }
        }

        function openProjectModal(id = null) {
            const modal = document.getElementById('projectModal');
            const title = document.getElementById('projectModalTitle');
            const deleteBtn = document.getElementById('deleteProjectBtn');
            
            if (id) {
                const p = data.projects.find(pr => pr.id === id);
                title.textContent = '‚úèÔ∏è Modifier le Restaurant';
                document.getElementById('editProjectId').value = id;
                document.getElementById('newProjectName').value = p.name;
                document.getElementById('newProjectContact').value = p.contact;
                document.getElementById('newProjectPhone').value = p.phone || '';
                document.getElementById('newProjectRevenue').value = p.revenue || '';
                document.getElementById('newProjectNotes').value = p.notes || '';
                deleteBtn.classList.remove('hidden');
            } else {
                title.textContent = 'üçΩÔ∏è Nouveau Restaurant';
                document.getElementById('editProjectId').value = '';
                document.getElementById('newProjectName').value = '';
                document.getElementById('newProjectContact').value = '';
                document.getElementById('newProjectPhone').value = '';
                document.getElementById('newProjectRevenue').value = '';
                document.getElementById('newProjectNotes').value = '';
                deleteBtn.classList.add('hidden');
            }
            
            modal.classList.remove('hidden');
        }

        function closeProjectModal() {
            document.getElementById('projectModal').classList.add('hidden');
        }

        function editProject(id) {
            openProjectModal(id);
        }

        function saveProject() {
            const id = document.getElementById('editProjectId').value;
            const name = document.getElementById('newProjectName').value.trim();
            const contact = document.getElementById('newProjectContact').value.trim();
            const phone = document.getElementById('newProjectPhone').value.trim();
            const revenue = parseInt(document.getElementById('newProjectRevenue').value) || 0;
            const notes = document.getElementById('newProjectNotes').value.trim();
            
            if (!name || !contact) {
                alert('‚ö†Ô∏è Nom et email obligatoires');
                return;
            }
            
            if (id) {
                const project = data.projects.find(p => p.id === id);
                project.name = name;
                project.contact = contact;
                project.phone = phone;
                project.revenue = revenue;
                project.notes = notes;
                addNotification(`‚úèÔ∏è Restaurant "${name}" modifi√©`);
            } else {
                data.projects.push({
                    id: 'p-' + Date.now(),
                    name, contact, phone, revenue, notes
                });
                addNotification(`‚ûï Restaurant "${name}" cr√©√©`);
            }
            
            closeProjectModal();
            updateUI();
            saveToFirebase();
        }

        function deleteProject(id) {
            const project = data.projects.find(p => p.id === id);
            if (confirm(`‚ùå Supprimer "${project.name}" ?\n\nToutes les t√¢ches associ√©es seront supprim√©es.`)) {
                data.projects = data.projects.filter(p => p.id !== id);
                data.tasks = data.tasks.filter(t => t.projectId !== id);
                addNotification(`üóëÔ∏è Restaurant "${project.name}" supprim√©`);
                updateUI();
                saveToFirebase();
            }
        }

        function deleteCurrentProject() {
            const id = document.getElementById('editProjectId').value;
            if (id) {
                closeProjectModal();
                deleteProject(id);
            }
        }

        // Tasks
        function loadTasks() {
            const list = document.getElementById('tasksList');
            
            if (data.tasks.length === 0) {
                list.innerHTML = '<div class="text-gray-500 text-sm text-center py-4">Aucune t√¢che</div>';
            } else {
                const priorityColors = {low: 'green', medium: 'blue', high: 'orange', urgent: 'red'};
                const statusIcons = {todo: 'üìù', doing: 'üîÑ', blocked: '‚ö†Ô∏è', done: '‚úÖ'};
                
                list.innerHTML = data.tasks.map(t => {
                    const project = data.projects.find(p => p.id === t.projectId);
                    return `
                        <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded border-l-4 border-${priorityColors[t.priority]}-500 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600" onclick="editTask('${t.id}')">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="font-semibold dark:text-white">${statusIcons[t.status]} ${t.title}</div>
                                    <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">
                                        ${project ? project.name : 'Sans projet'} ‚Ä¢ ${t.assignee}
                                    </div>
                                </div>
                                <button onclick="event.stopPropagation(); deleteTask('${t.id}')" class="text-red-500 hover:text-red-700 ml-2">üóëÔ∏è</button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function openTaskModal(id = null) {
            const modal = document.getElementById('taskModal');
            const title = document.getElementById('taskModalTitle');
            const deleteBtn = document.getElementById('deleteTaskBtn');
            
            if (id) {
                const t = data.tasks.find(task => task.id === id);
                title.textContent = '‚úèÔ∏è Modifier la T√¢che';
                document.getElementById('editTaskId').value = id;
                document.getElementById('newTaskTitle').value = t.title;
                document.getElementById('newTaskDesc').value = t.desc || '';
                document.getElementById('newTaskProject').value = t.projectId;
                document.getElementById('newTaskAssignee').value = t.assignee;
                document.getElementById('newTaskPriority').value = t.priority;
                document.getElementById('newTaskStatus').value = t.status;
                document.getElementById('newTaskDeadline').value = t.deadline || '';
                deleteBtn.classList.remove('hidden');
            } else {
                title.textContent = '‚ûï Nouvelle T√¢che';
                document.getElementById('editTaskId').value = '';
                document.getElementById('newTaskTitle').value = '';
                document.getElementById('newTaskDesc').value = '';
                document.getElementById('newTaskProject').value = '';
                document.getElementById('newTaskAssignee').value = 'Stephen';
                document.getElementById('newTaskPriority').value = 'medium';
                document.getElementById('newTaskStatus').value = 'todo';
                document.getElementById('newTaskDeadline').value = '';
                deleteBtn.classList.add('hidden');
            }
            
            modal.classList.remove('hidden');
        }

        function closeTaskModal() {
            document.getElementById('taskModal').classList.add('hidden');
        }

        function editTask(id) {
            openTaskModal(id);
        }

        function saveTask() {
            const id = document.getElementById('editTaskId').value;
            const title = document.getElementById('newTaskTitle').value.trim();
            const desc = document.getElementById('newTaskDesc').value.trim();
            const projectId = document.getElementById('newTaskProject').value;
            const assignee = document.getElementById('newTaskAssignee').value;
            const priority = document.getElementById('newTaskPriority').value;
            const status = document.getElementById('newTaskStatus').value;
            const deadline = document.getElementById('newTaskDeadline').value;
            
            if (!title) {
                alert('‚ö†Ô∏è Titre obligatoire');
                return;
            }
            
            if (id) {
                const task = data.tasks.find(t => t.id === id);
                task.title = title;
                task.desc = desc;
                task.projectId = projectId;
                task.assignee = assignee;
                task.priority = priority;
                task.status = status;
                task.deadline = deadline;
                addNotification(`‚úèÔ∏è T√¢che "${title}" modifi√©e`);
            } else {
                data.tasks.push({
                    id: 't-' + Date.now(),
                    title, desc, projectId, assignee, priority, status, deadline
                });
                addNotification(`‚ûï T√¢che "${title}" cr√©√©e`);
            }
            
            closeTaskModal();
            updateUI();
            saveToFirebase();
        }

        function deleteTask(id) {
            const task = data.tasks.find(t => t.id === id);
            if (confirm(`‚ùå Supprimer "${task.title}" ?`)) {
                data.tasks = data.tasks.filter(t => t.id !== id);
                addNotification(`üóëÔ∏è T√¢che "${task.title}" supprim√©e`);
                updateUI();
                saveToFirebase();
            }
        }

        function deleteCurrentTask() {
            const id = document.getElementById('editTaskId').value;
            if (id) {
                closeTaskModal();
                deleteTask(id);
            }
        }

        // Update UI
        function updateUI() {
            // Calculate MRR
            data.settings.currentMRR = data.projects.reduce((sum, p) => sum + (p.revenue || 0), 0);
            
            // Update metrics
            document.getElementById('signedRestaurants').textContent = data.settings.signedRestaurants;
            document.getElementById('signedGoal').textContent = data.settings.signedGoal;
            document.getElementById('totalMRR').textContent = data.settings.currentMRR;
            document.getElementById('activeProjectsCount').textContent = data.projects.length;
            
            const completed = data.tasks.filter(t => t.status === 'done').length;
            const total = data.tasks.length;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('totalTasks').textContent = total;
            
            // Reload lists
            loadProjects();
            loadTasks();
            loadNotifications();
        }

        // Init
        window.initApp = async function() {
            console.log('üöÄ D√©marrage RestaurantOS');
            
            const loaded = await loadFromFirebase();
            
            if (!loaded) {
                console.log('üí° Mode d√©mo activ√©');
                data.projects = [
                    {id: 'demo-1', name: 'La Bella Vita', contact: 'contact@bellavita.fr', phone: '0612345678', revenue: 400, notes: 'En d√©veloppement'},
                    {id: 'demo-2', name: 'Sushi Zen', contact: 'contact@sushizen.fr', phone: '0698765432', revenue: 350, notes: 'D√©mo pr√©vue'}
                ];
                data.tasks = [
                    {id: 'demo-t1', projectId: 'demo-1', title: 'Finaliser le site', desc: 'Derniers ajustements', assignee: 'Stephen', priority: 'high', status: 'doing', deadline: '2025-12-30'},
                    {id: 'demo-t2', projectId: 'demo-2', title: 'Pr√©parer la d√©mo', desc: 'Pr√©sentation client', assignee: 'Eva', priority: 'urgent', status: 'todo', deadline: '2025-12-28'}
                ];
            }
            
            if (data.settings.darkMode) {
                document.body.classList.add('dark');
                document.getElementById('darkModeIcon').textContent = '‚òÄÔ∏è';
            }
            
            updateUI();
            console.log('‚úÖ RestaurantOS pr√™t ! Projets:', data.projects.length, '| T√¢ches:', data.tasks.length);
        }

        // Close modals on escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeProjectModal();
                closeTaskModal();
                document.getElementById('notificationsPanel').classList.add('hidden');
            }
        });

        // Close notifications panel when clicking outside
        document.addEventListener('click', (e) => {
            const panel = document.getElementById('notificationsPanel');
            const btn = e.target.closest('button[onclick="toggleNotifications()"]');
            if (!panel.contains(e.target) && !btn && !panel.classList.contains('hidden')) {
                panel.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
