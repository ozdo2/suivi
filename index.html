<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RestaurantOS - Plateforme de Gestion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
    
    <style>
        .phase-progress { transition: width 0.3s ease; }
        .task-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .task-card { transition: all 0.2s ease; }
        .modal-enter { animation: fadeIn 0.2s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .notification { animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        
        /* Dark Mode - Plus complet */
        .dark { background-color: #0f172a !important; color: #e2e8f0 !important; }
        .dark body { background-color: #0f172a !important; }
        .dark .bg-white { background-color: #1e293b !important; color: #e2e8f0 !important; }
        .dark .bg-gray-50 { background-color: #0f172a !important; }
        .dark .bg-gray-100 { background-color: #334155 !important; }
        .dark .text-gray-600 { color: #94a3b8 !important; }
        .dark .text-gray-700 { color: #cbd5e1 !important; }
        .dark .text-gray-900 { color: #f1f5f9 !important; }
        .dark .text-gray-500 { color: #64748b !important; }
        .dark .border { border-color: #334155 !important; }
        .dark .border-b { border-bottom-color: #334155 !important; }
        .dark .border-t { border-top-color: #334155 !important; }
        .dark .divide-y > * { border-color: #334155 !important; }
        .dark .shadow { box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.5) !important; }
        .dark .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5) !important; }
        .dark .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5) !important; }
        .dark .hover\:bg-gray-50:hover { background-color: #334155 !important; }
        .dark .hover\:bg-gray-100:hover { background-color: #475569 !important; }
        
        .dark nav { background-color: #1e293b !important; border-bottom-color: #334155 !important; }
        
        .dark input[type="text"],
        .dark input[type="email"],
        .dark input[type="tel"],
        .dark input[type="number"],
        .dark input[type="date"],
        .dark input[type="checkbox"],
        .dark textarea,
        .dark select {
            background-color: #334155 !important;
            color: #e2e8f0 !important;
            border-color: #475569 !important;
        }
        
        .dark input[type="text"]:focus,
        .dark input[type="email"]:focus,
        .dark input[type="tel"]:focus,
        .dark input[type="number"]:focus,
        .dark input[type="date"]:focus,
        .dark textarea:focus,
        .dark select:focus {
            background-color: #1e293b !important;
            border-color: #3b82f6 !important;
        }
        
        .dark input::placeholder,
        .dark textarea::placeholder {
            color: #64748b !important;
        }
        
        .dark .editable-number:hover {
            background-color: #334155 !important;
            border-color: #3b82f6 !important;
        }
        
        .dark .task-card {
            background-color: #1e293b !important;
        }
        
        .dark .task-card:hover {
            background-color: #334155 !important;
        }
        
        .dark .bg-blue-50 { background-color: #1e3a5f !important; }
        .dark .bg-green-50 { background-color: #1e3a2f !important; }
        .dark .bg-yellow-50 { background-color: #3a351e !important; }
        .dark .bg-purple-50 { background-color: #2e1e3a !important; }
        .dark .bg-blue-100 { background-color: #1e40af !important; }
        .dark .bg-green-100 { background-color: #166534 !important; }
        .dark .bg-red-100 { background-color: #991b1b !important; }
        .dark .bg-yellow-100 { background-color: #854d0e !important; }
        .dark .bg-purple-100 { background-color: #6b21a8 !important; }
        .dark .bg-orange-50 { background-color: #3a2e1e !important; }
        
        .dark .text-blue-600 { color: #60a5fa !important; }
        .dark .text-green-600 { color: #4ade80 !important; }
        .dark .text-purple-600 { color: #c084fc !important; }
        .dark .text-red-600 { color: #f87171 !important; }
        .dark .text-orange-600 { color: #fb923c !important; }
        .dark .text-yellow-600 { color: #fbbf24 !important; }
        .dark .text-yellow-800 { color: #fbbf24 !important; }
        .dark .text-blue-800 { color: #93c5fd !important; }
        .dark .text-green-800 { color: #86efac !important; }
        .dark .text-blue-700 { color: #60a5fa !important; }
        .dark .text-green-700 { color: #4ade80 !important; }
        .dark .text-red-700 { color: #f87171 !important; }
        .dark .text-gray-700 { color: #cbd5e1 !important; }
        
        .dark .border-blue-500 { border-color: #3b82f6 !important; }
        .dark .border-green-500 { border-color: #22c55e !important; }
        .dark .border-yellow-500 { border-color: #eab308 !important; }
        .dark .border-red-500 { border-color: #ef4444 !important; }
        .dark .border-purple-500 { border-color: #a855f7 !important; }
        .dark .border-orange-500 { border-color: #f97316 !important; }
        .dark .border-blue-200 { border-color: #1e40af !important; }
        .dark .border-green-200 { border-color: #166534 !important; }
        .dark .border-purple-200 { border-color: #6b21a8 !important; }
        
        .dark .bg-gradient-to-br { opacity: 0.95; }
        .dark [class*="bg-gradient"] { opacity: 0.95 !important; }

        .editable-number { 
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        .editable-number:hover { 
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .editable-number:focus {
            outline: none;
            border-color: #2563eb;
            background-color: white;
        }

        /* Firebase status indicator */
        .firebase-status {
            position: fixed;
            top: 70px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1000;
            animation: fadeIn 0.3s;
        }
        .firebase-connected {
            background-color: #10b981;
            color: white;
        }
        .firebase-disconnected {
            background-color: #ef4444;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Firebase Status Indicator -->
    <div id="firebaseStatus" class="firebase-status firebase-disconnected">
        üî¥ D√©connect√©
    </div>

    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-8">
                    <h1 class="text-xl font-bold text-blue-600">üçΩÔ∏è RestaurantOS</h1>
                    <div class="hidden md:flex space-x-4">
                        <button onclick="showPage('dashboard')" class="nav-btn px-3 py-2 rounded hover:bg-gray-100">Dashboard</button>
                        <button onclick="showPage('projects')" class="nav-btn px-3 py-2 rounded hover:bg-gray-100">Projets</button>
                        <button onclick="showPage('tasks')" class="nav-btn px-3 py-2 rounded hover:bg-gray-100">T√¢ches</button>
                        <button onclick="showPage('phases')" class="nav-btn px-3 py-2 rounded hover:bg-gray-100">Phases</button>
                        <button onclick="showPage('features')" class="nav-btn px-3 py-2 rounded hover:bg-gray-100">Features</button>
                        <button onclick="showPage('ai')" class="nav-btn px-3 py-2 rounded hover:bg-gray-100">IA Assistant</button>
                        <button onclick="showPage('analytics')" class="nav-btn px-3 py-2 rounded hover:bg-gray-100">Analytics</button>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button onclick="toggleDarkMode()" class="p-2 hover:bg-gray-100 rounded" title="Mode sombre">
                        <span id="darkModeIcon">üåô</span>
                    </button>
                    <button onclick="toggleNotifications()" class="relative p-2 hover:bg-gray-100 rounded">
                        üîî
                        <span id="notifBadge" class="hidden absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">3</span>
                    </button>
                    <span class="text-sm text-gray-600">üë§ <span id="userName">Fondateur</span></span>
                    <button onclick="logout()" class="text-sm text-red-600 hover:text-red-700">D√©connexion</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Notifications Panel avec suppression -->
    <div id="notificationsPanel" class="hidden fixed right-4 top-16 w-80 bg-white rounded-lg shadow-xl border z-50">
        <div class="p-4 border-b flex justify-between items-center">
            <h3 class="font-semibold">Notifications</h3>
            <button onclick="clearAllNotifications()" class="text-xs text-red-600 hover:text-red-700">Tout effacer</button>
        </div>
        <div id="notificationsList" class="max-h-96 overflow-y-auto divide-y">
            <!-- Notifications dynamiques -->
        </div>
    </div>

    <!-- Modal de Configuration Firebase (premi√®re utilisation) -->
    <div id="firebaseConfigModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4">
            <h2 class="text-2xl font-bold mb-4">üî• Configuration Firebase</h2>
            <p class="text-sm text-gray-600 mb-4">Colle ta configuration Firebase ci-dessous pour synchroniser ton tableau de bord en temps r√©el :</p>
            
            <textarea id="firebaseConfigInput" class="w-full h-64 border rounded px-3 py-2 font-mono text-sm bg-gray-50" placeholder='{
  "apiKey": "AIza...",
  "authDomain": "ton-projet.firebaseapp.com",
  "databaseURL": "https://ton-projet.firebaseio.com",
  "projectId": "ton-projet",
  "storageBucket": "ton-projet.appspot.com",
  "messagingSenderId": "123456789",
  "appId": "1:123456789:web:abc123"
}'></textarea>
            
            <div class="mt-4 flex space-x-2">
                <button onclick="skipFirebase()" class="flex-1 border rounded py-2 hover:bg-gray-50">Utiliser sans Firebase (local)</button>
                <button onclick="saveFirebaseConfig()" class="flex-1 bg-blue-600 text-white rounded py-2 hover:bg-blue-700">üíæ Sauvegarder et Connecter</button>
            </div>
            
            <div class="mt-4 p-3 bg-blue-50 rounded text-sm">
                <strong>üí° Astuce:</strong> Pour r√©cup√©rer cette configuration, va dans ton projet Firebase ‚Üí ‚öôÔ∏è Project Settings ‚Üí Scroll ‚Üí "Your apps" ‚Üí Web app config
            </div>
        </div>
    </div>

    <!-- PAGE: DASHBOARD -->
    <div id="dashboard" class="page max-w-7xl mx-auto px-4 py-6">
        <!-- KPIs √âditables -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white p-4 rounded-lg shadow">
                <div class="text-sm text-gray-600">Restaurants sign√©s</div>
                <div class="flex items-center justify-center space-x-2 mt-2">
                    <button onclick="changeGoalValue('signedGoal', -1)" class="w-8 h-8 bg-red-500 text-white rounded hover:bg-red-600 text-lg">‚àí</button>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-600">
                            <span id="signedRestaurants">3</span>/<span id="signedGoal" contenteditable="true" class="editable-number inline-block px-2 rounded">10</span>
                        </div>
                    </div>
                    <button onclick="changeGoalValue('signedGoal', 1)" class="w-8 h-8 bg-green-500 text-white rounded hover:bg-green-600 text-lg">+</button>
                </div>
                <div class="text-xs text-gray-500 mt-1 text-center">Objectif mois</div>
            </div>
            
            <div class="bg-white p-4 rounded-lg shadow">
                <div class="text-sm text-gray-600">Revenu MRR</div>
                <div class="text-center mt-2">
                    <input id="mrr" type="number" value="1200" onchange="updateMRR(this.value)" class="text-2xl font-bold text-green-600 text-center w-24 border-0 editable-number rounded px-2">
                    <span class="text-2xl font-bold text-green-600">‚Ç¨</span>
                    <div class="text-xs text-gray-500 mt-1">
                        / <input id="mrrGoal" type="number" value="5000" class="w-16 text-xs border-0 editable-number rounded px-1" onchange="saveData()">‚Ç¨ objectif
                    </div>
                </div>
            </div>
            
            <div class="bg-white p-4 rounded-lg shadow">
                <div class="text-sm text-gray-600">T√¢ches compl√©t√©es</div>
                <div class="text-2xl font-bold text-purple-600 text-center mt-2">
                    <span id="completedTasks">0</span>/<span id="totalTasks">0</span>
                </div>
                <div class="text-xs text-gray-500 mt-1 text-center"><span id="completionPercent">0</span>% de progression</div>
            </div>
            
            <div class="bg-white p-4 rounded-lg shadow">
                <div class="text-sm text-gray-600">T√¢ches en cours</div>
                <div class="text-2xl font-bold text-orange-600 text-center mt-2"><span id="ongoingTasks">0</span></div>
                <div class="text-xs text-gray-500 mt-1 text-center">√Ä suivre</div>
            </div>
        </div>

        <!-- Projets actifs -->
        <div class="bg-white rounded-lg shadow mb-6">
            <div class="p-4 border-b">
                <h2 class="text-lg font-semibold">üöÄ Projets Actifs</h2>
            </div>
            <div id="activeProjects" class="divide-y">
                <!-- Projects loaded dynamically -->
            </div>
        </div>

        <!-- T√¢ches urgentes et IA -->
        <div class="grid md:grid-cols-2 gap-6">
            <div class="bg-white rounded-lg shadow">
                <div class="p-4 border-b">
                    <h2 class="text-lg font-semibold">‚úÖ Mes T√¢ches Prioritaires</h2>
                </div>
                <div id="urgentTasks" class="p-4 space-y-3">
                    <!-- Tasks loaded dynamically -->
                </div>
            </div>

            <div class="bg-blue-50 rounded-lg shadow border-2 border-blue-200">
                <div class="p-4 border-b border-blue-200 bg-blue-100">
                    <h2 class="text-lg font-semibold text-blue-800">üí° IA Assistant</h2>
                </div>
                <div class="p-4">
                    <div class="bg-white rounded p-3 mb-3 text-sm">
                        <strong>Suggestion du jour:</strong><br>
                        Commence par les t√¢ches prioritaires pour maximiser ton efficacit√©.
                    </div>
                    <button onclick="openAI()" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                        Discuter avec l'IA
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Autres pages... (je vais simplifier pour la longueur) -->
    <div id="projects" class="page hidden max-w-7xl mx-auto px-4 py-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">üìÅ Tous les Projets</h2>
            <button onclick="openProjectModal()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">+ Nouveau Restaurant</button>
        </div>
        <div id="projectsList" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </div>

    <div id="tasks" class="page hidden max-w-7xl mx-auto px-4 py-6">
        <h2 class="text-2xl font-bold mb-6">üìã Gestion des T√¢ches</h2>
        <div id="tasksBoard" class="grid md:grid-cols-4 gap-4">
            <div class="bg-gray-100 rounded-lg p-4">
                <h3 class="font-semibold mb-3">üìù √Ä faire (<span id="todoCount">0</span>)</h3>
                <div id="todoColumn" class="space-y-2"></div>
            </div>
            <div class="bg-blue-100 rounded-lg p-4">
                <h3 class="font-semibold mb-3">üîÑ En cours (<span id="doingCount">0</span>)</h3>
                <div id="doingColumn" class="space-y-2"></div>
            </div>
            <div class="bg-red-100 rounded-lg p-4">
                <h3 class="font-semibold mb-3">‚ö†Ô∏è Bloqu√©es (<span id="blockedCount">0</span>)</h3>
                <div id="blockedColumn" class="space-y-2"></div>
            </div>
            <div class="bg-green-100 rounded-lg p-4">
                <h3 class="font-semibold mb-3">‚úÖ Termin√©es (<span id="doneCount">0</span>)</h3>
                <div id="doneColumn" class="space-y-2"></div>
            </div>
        </div>
    </div>

    <div id="phases" class="page hidden max-w-7xl mx-auto px-4 py-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">üéØ Gestion des Phases</h2>
            <button onclick="openPhaseModal()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                + Ajouter une Phase
            </button>
        </div>
        
        <div id="phasesList" class="space-y-6">
            <!-- Phases loaded dynamically -->
        </div>
    </div>

    <div id="features" class="page hidden max-w-7xl mx-auto px-4 py-6">
        <h2 class="text-2xl font-bold mb-6">‚öôÔ∏è Features Restaurant</h2>
        <div id="featuresList" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </div>

    <div id="analytics" class="page hidden max-w-7xl mx-auto px-4 py-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">üìà Analytics Business</h2>
            <button onclick="openAnalyticsModal()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                ‚öôÔ∏è Modifier les m√©triques
            </button>
        </div>
        
        <div class="grid md:grid-cols-3 gap-6 mb-6">
            <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-lg shadow-lg p-6">
                <div class="text-sm opacity-90 mb-2">Revenus totaux (ann√©e)</div>
                <div class="text-3xl font-bold"><span id="analyticsYearRevenue">14400</span>‚Ç¨</div>
                <div class="text-sm mt-2 opacity-75">+<span id="analyticsYearGrowth">32</span>% vs ann√©e derni√®re</div>
            </div>
            <div class="bg-gradient-to-br from-green-500 to-green-600 text-white rounded-lg shadow-lg p-6">
                <div class="text-sm opacity-90 mb-2">Temps gagn√© clients</div>
                <div class="text-3xl font-bold"><span id="analyticsTimeSaved">540</span>h/mois</div>
                <div class="text-sm mt-2 opacity-75">Pour <span id="analyticsActiveClients">3</span> restaurants actifs</div>
            </div>
            <div class="bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-lg shadow-lg p-6">
                <div class="text-sm opacity-90 mb-2">Taux de conversion</div>
                <div class="text-3xl font-bold"><span id="analyticsConversionRate">30</span>%</div>
                <div class="text-sm mt-2 opacity-75">D√©mo ‚Üí Client sign√©</div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg">üí∞ R√©partition des Revenus</h3>
                <button onclick="openRevenueModal()" class="text-sm bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">
                    ‚úèÔ∏è Modifier
                </button>
            </div>
            <div id="revenueBreakdownList" class="space-y-3">
                <!-- Revenue breakdown loaded dynamically -->
            </div>
        </div>
    </div>

    <div id="ai" class="page hidden max-w-4xl mx-auto px-4 py-6">
        <div class="bg-white rounded-lg shadow">
            <div class="p-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-t-lg">
                <h2 class="text-xl font-bold">ü§ñ Assistant IA RestaurantOS</h2>
            </div>
            <div id="chatMessages" class="p-4 h-96 overflow-y-auto"></div>
        </div>
    </div>

    <script>
        // FIREBASE CONFIGURATION - Configuration pr√©-remplie
        let firebaseApp = null;
        let database = null;
        let analytics = null;
        let useFirebase = false;

        const defaultFirebaseConfig = {
            apiKey: "AIzaSyDOXDHOQj2cADZ9ai2uHzQ1lE8HsX3P3Hg",
            authDomain: "restaurantos-7bf0a.firebaseapp.com",
            databaseURL: "https://restaurantos-7bf0a-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "restaurantos-7bf0a",
            storageBucket: "restaurantos-7bf0a.firebasestorage.app",
            messagingSenderId: "501432201588",
            appId: "1:501432201588:web:3720005ca099406dab3c21",
            measurementId: "G-N1KHN4JGEM"
        };

        function initFirebase(config) {
            try {
                firebaseApp = firebase.initializeApp(config);
                database = firebase.database();
                analytics = firebase.analytics();
                useFirebase = true;
                
                database.ref('restaurantOS').on('value', (snapshot) => {
                    const remoteData = snapshot.val();
                    if (remoteData) {
                        data = remoteData;
                        refreshAllUI();
                        updateFirebaseStatus(true);
                    }
                });
                
                database.ref('.info/connected').on('value', (snapshot) => {
                    updateFirebaseStatus(snapshot.val());
                });
                
                console.log('‚úÖ Firebase initialis√© avec succ√®s');
                return true;
            } catch (error) {
                console.error('‚ùå Erreur Firebase:', error);
                return false;
            }
        }

        function updateFirebaseStatus(connected) {
            const statusEl = document.getElementById('firebaseStatus');
            if (connected) {
                statusEl.className = 'firebase-status firebase-connected';
                statusEl.textContent = 'üü¢ Synchronis√©';
            } else {
                statusEl.className = 'firebase-status firebase-disconnected';
                statusEl.textContent = 'üî¥ D√©connect√©';
            }
        }

        function saveFirebaseConfig() {
            const input = document.getElementById('firebaseConfigInput').value.trim();
            if (!input) {
                alert('‚ö†Ô∏è Veuillez coller votre configuration Firebase');
                return;
            }
            
            try {
                const config = JSON.parse(input);
                if (!config.apiKey || !config.databaseURL) {
                    throw new Error('Configuration invalide');
                }
                
                localStorage.setItem('firebaseConfig', input);
                if (initFirebase(config)) {
                    document.getElementById('firebaseConfigModal').classList.add('hidden');
                    loadData();
                }
            } catch (error) {
                alert('‚ùå Configuration invalide. Assurez-vous de coller un JSON valide.');
                console.error(error);
            }
        }

        function skipFirebase() {
            useFirebase = false;
            document.getElementById('firebaseConfigModal').classList.add('hidden');
            document.getElementById('firebaseStatus').style.display = 'none';
            loadData();
        }

        // ========================================
        // DATA STRUCTURE
        // ========================================
        let data = {
            settings: {
                signedGoal: 5,
                signedCount: 3,
                mrrGoal: 5000,
                currentMRR: 1200
            },
            projects: [
                {id: 1, name: "La Bella Vita", contact: "contact@bellavita.fr", phone: "0612345678", status: "active", revenue: 400, phase: 2, progress: 65, assignee: "Stephen", features: [1, 2, 3]},
                {id: 2, name: "Sushi Zen", contact: "sushi@zen.fr", phone: "0698765432", status: "demo", revenue: 350, phase: 1, progress: 20, assignee: "Eva", features: [1, 2]},
                {id: 3, name: "Le Gourmet", contact: "contact@legourmet.fr", phone: "0687654321", status: "active", revenue: 450, phase: 3, progress: 85, assignee: "Stephen", features: [1, 2, 3, 4]}
            ],
            tasks: [
                {id: 1, projectId: 1, title: "Finaliser prompt IA", desc: "Optimiser les r√©ponses", phase: 2, assignee: "Stephen", status: "doing", priority: "high", deadline: "2025-12-27", goal: "Am√©liorer satisfaction"},
                {id: 2, projectId: 2, title: "D√©ployer site", desc: "Mise en production", phase: 1, assignee: "Eva", status: "todo", priority: "urgent", deadline: "2025-12-28", goal: "Lancer d√©mo"},
                {id: 3, projectId: 1, title: "Int√©grer Stripe", desc: "Paiements en ligne", phase: 2, assignee: "Stephen", status: "todo", priority: "medium", deadline: "2025-12-30", goal: "Revenus"},
                {id: 4, projectId: 3, title: "Formation client", desc: "Onboarding √©quipe", phase: 3, assignee: "Stephen", status: "done", priority: "high", deadline: "2025-12-23", goal: "Autonomie"},
                {id: 5, projectId: 2, title: "Script de vente", desc: "Pitch cold calling", phase: 1, assignee: "Eva", status: "doing", priority: "high", deadline: "2025-12-26", goal: "Conversion"}
            ],
            features: [
                {id: 1, name: "R√©servations", icon: "üìÖ", desc: "R√©servation automatis√©e", type: "included", price: 0},
                {id: 2, name: "Menus digitaux", icon: "üçΩÔ∏è", desc: "QR Code menu dynamique", type: "included", price: 0},
                {id: 3, name: "Messagerie", icon: "üí¨", desc: "Communication interne", type: "included", price: 0},
                {id: 4, name: "Commandes", icon: "üõí", desc: "Click & collect", type: "premium", price: 5},
                {id: 5, name: "Analytics", icon: "üìä", desc: "Statistiques d√©taill√©es", type: "premium", price: 3},
                {id: 6, name: "Fid√©lit√©", icon: "üéÅ", desc: "Programme de points", type: "premium", price: 2}
            ],
            phases: [
                {id: 1, name: "D√©mo Fonctionnelle", duration: "7-10 jours", color: "blue", codeTasks: ["Structure HTML/CSS", "Interface admin", "Base de donn√©es"], strategyTasks: ["Prompt ma√Ætre IA", "Arguments de vente", "√âtude de march√©"]},
                {id: 2, name: "Int√©gration & Intelligence", duration: "5-7 jours", color: "green", codeTasks: ["API OpenAI", "Notifications email", "QR Code"], strategyTasks: ["Tests prompts", "Calcul √©conomies"]},
                {id: 3, name: "Communication & Lancement", duration: "3-5 jours", color: "yellow", codeTasks: ["Optimisation mobile", "D√©ploiement", "Acc√®s Admin"], strategyTasks: ["Identit√© visuelle", "Script vente", "Deck pr√©sentation", "Onboarding"]},
                {id: 4, name: "Suivi & Croissance", duration: "Continu", color: "purple", codeTasks: ["Automatisation sites", "Stripe", "Fid√©lit√©"], strategyTasks: ["T√©moignages", "Contenu social", "Parrainage"]}
            ],
            analytics: {
                yearRevenue: 14400,
                yearGrowth: 32,
                timeSaved: 540,
                conversionRate: 30,
                revenueBreakdown: [
                    {name: "Abonnements", amount: 1200},
                    {name: "Services additionnels", amount: 300},
                    {name: "Formations", amount: 200}
                ]
            },
            contracts: [
                {id: 1, name: "Starter", price: 350, desc: "Petits restaurants", color: "blue"},
                {id: 2, name: "Standard", price: 400, desc: "Forfait classique", color: "green"},
                {id: 3, name: "Premium", price: 450, desc: "Toutes les features", color: "purple"}
            ],
            notifications: [],
            darkMode: true
        };

        let currentUser = "Stephen";
        let currentProjectId = null;

        // ========================================
        // SAVE/LOAD DATA
        // ========================================
        function saveData() {
            if (useFirebase && database) {
                database.ref('restaurantOS').set(data).catch(err => {
                    console.error('Erreur Firebase save:', err);
                });
            } else {
                try {
                    localStorage.setItem('restaurantOS_data', JSON.stringify(data));
                } catch (e) {
                    console.error('Erreur sauvegarde locale:', e);
                }
            }
        }

        function loadData() {
            if (useFirebase) {
                // Les donn√©es sont charg√©es automatiquement via le listener Firebase
                return;
            }
            
            try {
                const saved = localStorage.getItem('restaurantOS_data');
                if (saved) {
                    const savedData = JSON.parse(saved);
                    data = { ...data, ...savedData };
                }
            } catch (e) {
                console.error('Erreur chargement:', e);
            }
            refreshAllUI();
        }

        function refreshAllUI() {
            loadDashboard();
            loadProjects();
            loadTasks();
            loadFeatures();
            loadPhases();
            loadAnalytics();
            loadNotifications();
            
            document.getElementById('mrr').value = data.settings.currentMRR;
            document.getElementById('mrrGoal').value = data.settings.mrrGoal;
            document.getElementById('signedGoal').textContent = data.settings.signedGoal;
            document.getElementById('signedRestaurants').textContent = data.settings.signedCount;
        }

        // ========================================
        // EDITABLE GOALS
        // ========================================
        function changeSignedCount(delta) {
            data.settings.signedCount = Math.max(0, data.settings.signedCount + delta);
            document.getElementById('signedRestaurants').textContent = data.settings.signedCount;
            saveData();
        }

        function updateMRR(value) {
            data.settings.currentMRR = parseInt(value) || 0;
            saveData();
        }

        // ========================================
        // DARK MODE
        // ========================================
        function toggleDarkMode() {
            data.darkMode = !data.darkMode;
            document.body.classList.toggle('dark', data.darkMode);
            document.getElementById('darkModeIcon').textContent = data.darkMode ? '‚òÄÔ∏è' : 'üåô';
            saveData();
        }

        function loadDarkMode() {
            document.body.classList.add('dark');
            document.getElementById('darkModeIcon').textContent = '‚òÄÔ∏è';
        }

        // ========================================
        // DASHBOARD
        // ========================================
        function loadDashboard() {
            const activeProjects = document.getElementById('activeProjects');
            activeProjects.innerHTML = data.projects.filter(p => p.status === 'active' || p.status === 'demo').map(p => `
                <div class="p-4 hover:bg-gray-50 cursor-pointer" onclick="alert('Projet: ${p.name}')">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h3 class="font-semibold">${getProjectIcon(p.name)} ${p.name}</h3>
                            <span class="text-xs text-gray-500">Phase ${p.phase} | ${p.progress}%</span>
                        </div>
                        <span class="px-2 py-1 text-xs rounded ${getStatusColor(p.status)}">${getStatusText(p.status)}</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2 mb-2">
                        <div class="bg-blue-600 h-2 rounded-full" style="width: ${p.progress}%"></div>
                    </div>
                    <div class="flex justify-between text-xs text-gray-600">
                        <span>üë§ ${p.assignee}</span>
                        <span>üí∞ ${p.revenue}‚Ç¨/mois</span>
                    </div>
                </div>
            `).join('');

            const urgentTasks = document.getElementById('urgentTasks');
            const urgent = data.tasks.filter(t => (t.priority === 'urgent' || t.priority === 'high') && t.status !== 'done').slice(0, 5);
            urgentTasks.innerHTML = urgent.length > 0 ? urgent.map(t => {
                const project = data.projects.find(p => p.id === t.projectId);
                return `
                    <div class="border-l-4 ${getPriorityColor(t.priority)} pl-3 py-2 bg-gray-50 rounded">
                        <div class="font-medium text-sm">${t.title}</div>
                        <div class="text-xs text-gray-600 mt-1">${project ? project.name : 'N/A'} ‚Ä¢ ${t.assignee}</div>
                    </div>
                `;
            }).join('') : '<div class="text-gray-500 text-sm">Aucune t√¢che prioritaire</div>';

            document.getElementById('signedRestaurants').textContent = data.settings.signedCount;
            document.getElementById('signedGoal').textContent = data.settings.signedGoal;
            
            const completed = data.tasks.filter(t => t.status === 'done').length;
            const total = data.tasks.length;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('totalTasks').textContent = total;
            document.getElementById('completionPercent').textContent = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            document.getElementById('ongoingTasks').textContent = data.tasks.filter(t => t.status === 'doing').length;
        }

        // ========================================
        // NAVIGATION
        // ========================================
        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById(pageName).classList.remove('hidden');
            
            if (pageName === 'projects') loadProjects();
            if (pageName === 'tasks') loadTasks();
            if (pageName === 'features') loadFeatures();
            if (pageName === 'phases') loadPhases();
            if (pageName === 'analytics') loadAnalytics();
        }

        // ========================================
        // PHASES
        // ========================================
        function loadPhases() {
            const phasesList = document.getElementById('phasesList');
            if (!phasesList) return;
            
            phasesList.innerHTML = data.phases.map(p => `
                <div class="bg-white rounded-lg shadow">
                    <div class="p-4 border-b bg-${p.color}-50">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-bold text-${p.color}-800">${p.name}</h3>
                            <div class="flex space-x-2">
                                <span class="text-sm text-gray-600">${p.duration}</span>
                                <button onclick="editPhase(${p.id})" class="text-blue-600 hover:text-blue-700">‚úèÔ∏è</button>
                                <button onclick="deletePhase(${p.id})" class="text-red-600 hover:text-red-700">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-semibold mb-2 text-blue-600">üíª CODE</h4>
                                <ul class="space-y-2 text-sm">
                                    ${p.codeTasks.map(task => `
                                        <li class="flex items-start">
                                            <input type="checkbox" class="mt-1 mr-2">
                                            <span>${task}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold mb-2 text-purple-600">üß† IA & STRAT√âGIE</h4>
                                <ul class="space-y-2 text-sm">
                                    ${p.strategyTasks.map(task => `
                                        <li class="flex items-start">
                                            <input type="checkbox" class="mt-1 mr-2">
                                            <span>${task}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function openPhaseModal() {
            document.getElementById('phaseModalTitle').textContent = '‚ûï Ajouter une Phase';
            document.getElementById('editPhaseId').value = '';
            document.getElementById('newPhaseName').value = '';
            document.getElementById('newPhaseDuration').value = '';
            document.getElementById('newPhaseColor').value = 'blue';
            document.getElementById('newPhaseCodeTasks').value = '';
            document.getElementById('newPhaseStrategyTasks').value = '';
            document.getElementById('phaseModal').classList.remove('hidden');
        }

        function closePhaseModal() {
            document.getElementById('phaseModal').classList.add('hidden');
        }

        function editPhase(id) {
            const phase = data.phases.find(p => p.id === id);
            if (!phase) return;
            
            document.getElementById('phaseModalTitle').textContent = '‚úèÔ∏è Modifier la Phase';
            document.getElementById('editPhaseId').value = phase.id;
            document.getElementById('newPhaseName').value = phase.name;
            document.getElementById('newPhaseDuration').value = phase.duration;
            document.getElementById('newPhaseColor').value = phase.color;
            document.getElementById('newPhaseCodeTasks').value = phase.codeTasks.join('\n');
            document.getElementById('newPhaseStrategyTasks').value = phase.strategyTasks.join('\n');
            document.getElementById('phaseModal').classList.remove('hidden');
        }

        function savePhase() {
            const editId = document.getElementById('editPhaseId').value;
            const name = document.getElementById('newPhaseName').value;
            const duration = document.getElementById('newPhaseDuration').value;
            const color = document.getElementById('newPhaseColor').value;
            const codeTasks = document.getElementById('newPhaseCodeTasks').value.split('\n').filter(t => t.trim());
            const strategyTasks = document.getElementById('newPhaseStrategyTasks').value.split('\n').filter(t => t.trim());

            if (!name) {
                alert('‚ö†Ô∏è Nom de la phase obligatoire');
                return;
            }

            if (editId) {
                const phase = data.phases.find(p => p.id === parseInt(editId));
                if (phase) {
                    phase.name = name;
                    phase.duration = duration;
                    phase.color = color;
                    phase.codeTasks = codeTasks;
                    phase.strategyTasks = strategyTasks;
                    addNotification('success', `Phase "${name}" modifi√©e`, 'Maintenant');
                }
            } else {
                const newId = Math.max(...data.phases.map(p => p.id), 0) + 1;
                data.phases.push({id: newId, name, duration, color, codeTasks, strategyTasks});
                addNotification('success', `Phase "${name}" cr√©√©e`, 'Maintenant');
            }

            closePhaseModal();
            loadPhases();
            saveData();
        }

        function deletePhase(id) {
            const phase = data.phases.find(p => p.id === id);
            if (confirm(`Supprimer la phase "${phase.name}" ?`)) {
                data.phases = data.phases.filter(p => p.id !== id);
                loadPhases();
                saveData();
                addNotification('success', `Phase "${phase.name}" supprim√©e`, 'Maintenant');
            }
        }

        // ========================================
        // ANALYTICS
        // ========================================
        function loadAnalytics() {
            document.getElementById('analyticsYearRevenue').textContent = data.analytics.yearRevenue;
            document.getElementById('analyticsYearGrowth').textContent = data.analytics.yearGrowth;
            document.getElementById('analyticsTimeSaved').textContent = data.analytics.timeSaved;
            document.getElementById('analyticsActiveClients').textContent = data.projects.filter(p => p.status === 'active').length;
            document.getElementById('analyticsConversionRate').textContent = data.analytics.conversionRate;

            // Revenue breakdown
            const revenueBreakdownList = document.getElementById('revenueBreakdownList');
            if (!revenueBreakdownList) return;
            
            revenueBreakdownList.innerHTML = data.analytics.revenueBreakdown.map((item, index) => `
                <div class="flex justify-between items-center p-3 border rounded hover:bg-gray-50">
                    <div class="flex-1">
                        <div class="font-semibold">${item.name}</div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <span class="font-bold text-lg text-green-600">${item.amount}‚Ç¨</span>
                        <button onclick="deleteRevenueCategory(${index})" class="text-red-500 hover:text-red-700">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function openAnalyticsModal() {
            document.getElementById('editYearRevenue').value = data.analytics.yearRevenue;
            document.getElementById('editYearGrowth').value = data.analytics.yearGrowth;
            document.getElementById('editTimeSaved').value = data.analytics.timeSaved;
            document.getElementById('editConversionRate').value = data.analytics.conversionRate;
            document.getElementById('analyticsModal').classList.remove('hidden');
        }

        function closeAnalyticsModal() {
            document.getElementById('analyticsModal').classList.add('hidden');
        }

        function saveAnalytics() {
            data.analytics.yearRevenue = parseInt(document.getElementById('editYearRevenue').value) || 0;
            data.analytics.yearGrowth = parseInt(document.getElementById('editYearGrowth').value) || 0;
            data.analytics.timeSaved = parseInt(document.getElementById('editTimeSaved').value) || 0;
            data.analytics.conversionRate = parseInt(document.getElementById('editConversionRate').value) || 0;
            
            closeAnalyticsModal();
            loadAnalytics();
            saveData();
            addNotification('success', 'M√©triques analytics mises √† jour', 'Maintenant');
        }

        function openRevenueModal() {
            const inputsContainer = document.getElementById('revenueBreakdownInputs');
            inputsContainer.innerHTML = data.analytics.revenueBreakdown.map((item, index) => `
                <div class="flex space-x-2">
                    <input type="text" value="${item.name}" class="flex-1 border rounded px-3 py-2 bg-white revenue-name" data-index="${index}">
                    <input type="number" value="${item.amount}" class="w-32 border rounded px-3 py-2 bg-white revenue-amount" data-index="${index}">
                    <button onclick="removeRevenueInput(${index})" class="px-3 bg-red-500 text-white rounded hover:bg-red-600">üóëÔ∏è</button>
                </div>
            `).join('');
            document.getElementById('revenueModal').classList.remove('hidden');
        }

        function closeRevenueModal() {
            document.getElementById('revenueModal').classList.add('hidden');
        }

        function addRevenueCategory() {
            const inputsContainer = document.getElementById('revenueBreakdownInputs');
            const index = data.analytics.revenueBreakdown.length;
            const div = document.createElement('div');
            div.className = 'flex space-x-2';
            div.innerHTML = `
                <input type="text" placeholder="Nom" class="flex-1 border rounded px-3 py-2 bg-white revenue-name" data-index="${index}">
                <input type="number" placeholder="Montant" class="w-32 border rounded px-3 py-2 bg-white revenue-amount" data-index="${index}">
                <button onclick="removeRevenueInput(${index})" class="px-3 bg-red-500 text-white rounded hover:bg-red-600">üóëÔ∏è</button>
            `;
            inputsContainer.appendChild(div);
        }

        function removeRevenueInput(index) {
            const inputs = document.querySelectorAll('.revenue-name');
            if (inputs.length > 1) {
                inputs[index].parentElement.remove();
            }
        }

        function saveRevenueBreakdown() {
            const names = document.querySelectorAll('.revenue-name');
            const amounts = document.querySelectorAll('.revenue-amount');
            
            data.analytics.revenueBreakdown = Array.from(names).map((nameInput, index) => ({
                name: nameInput.value || 'Sans nom',
                amount: parseInt(amounts[index].value) || 0
            }));
            
            closeRevenueModal();
            loadAnalytics();
            saveData();
            addNotification('success', 'R√©partition des revenus mise √† jour', 'Maintenant');
        }

        function deleteRevenueCategory(index) {
            if (confirm('Supprimer cette cat√©gorie ?')) {
                data.analytics.revenueBreakdown.splice(index, 1);
                loadAnalytics();
                saveData();
            }
        }

        // ========================================
        // NOTIFICATIONS
        // ========================================
        function loadNotifications() {
            const list = document.getElementById('notificationsList');
            if (data.notifications.length === 0) {
                list.innerHTML = '<div class="p-3 text-center text-gray-500 text-sm">Aucune notification</div>';
                document.getElementById('notifBadge').classList.add('hidden');
                return;
            }
            
            list.innerHTML = data.notifications.map(n => `
                <div class="p-3 hover:bg-gray-50 flex justify-between items-start">
                    <div class="flex items-start flex-1">
                        <span class="mr-2">${n.type === 'warning' ? '‚ö†Ô∏è' : n.type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è'}</span>
                        <div class="flex-1">
                            <div class="text-sm">${n.message}</div>
                            <div class="text-xs text-gray-500 mt-1">${n.time}</div>
                        </div>
                    </div>
                    <button onclick="deleteNotification(${n.id})" class="text-red-500 hover:text-red-700 ml-2">√ó</button>
                </div>
            `).join('');
            
            document.getElementById('notifBadge').classList.remove('hidden');
            document.getElementById('notifBadge').textContent = data.notifications.length;
        }

        function clearAllNotifications() {
            if (confirm('Effacer toutes les notifications ?')) {
                data.notifications = [];
                loadNotifications();
                saveData();
            }
        }

        function deleteNotification(id) {
            data.notifications = data.notifications.filter(n => n.id !== id);
            loadNotifications();
            saveData();
        }

        function addNotification(type, message, time) {
            const newId = Math.max(...data.notifications.map(n => n.id || 0), 0) + 1;
            data.notifications.unshift({id: newId, type, message, time});
            if (data.notifications.length > 10) data.notifications.pop();
            loadNotifications();
            saveData();
        }
        function loadProjects() {
            const projectsList = document.getElementById('projectsList');
            projectsList.innerHTML = data.projects.map(p => `
                <div class="bg-white rounded-lg shadow p-4 hover:shadow-lg transition cursor-pointer">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-bold text-lg">${getProjectIcon(p.name)} ${p.name}</h3>
                        <span class="px-2 py-1 text-xs rounded ${getStatusColor(p.status)}">${getStatusText(p.status)}</span>
                    </div>
                    <div class="text-sm text-gray-600 space-y-1 mb-3">
                        <div>üìß ${p.contact}</div>
                        <div>üì± ${p.phone}</div>
                        <div>üë§ ${p.assignee}</div>
                    </div>
                    <div class="border-t pt-3">
                        <div class="flex justify-between text-sm mb-2">
                            <span>Phase ${p.phase}/4</span>
                            <span class="font-semibold">${p.progress}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full" style="width: ${p.progress}%"></div>
                        </div>
                        <div class="mt-2 text-right">
                            <span class="text-green-600 font-bold">${p.revenue}‚Ç¨/mois</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function openProjectModal() {
            alert('Modal de cr√©ation de projet (simplifi√© pour d√©mo Firebase)');
        }

        // ========================================
        // TASKS
        // ========================================
        function loadTasks() {
            const columns = {todo: [], doing: [], blocked: [], done: []};
            data.tasks.forEach(t => columns[t.status].push(t));

            Object.keys(columns).forEach(status => {
                const col = document.getElementById(status + 'Column');
                const count = document.getElementById(status + 'Count');
                if (count) count.textContent = columns[status].length;
                
                col.innerHTML = columns[status].map(t => {
                    const project = data.projects.find(p => p.id === t.projectId);
                    return `
                        <div class="task-card bg-white p-3 rounded shadow-sm border-l-4 ${getPriorityColor(t.priority)} cursor-pointer">
                            <div class="font-semibold text-sm mb-1">${t.title}</div>
                            <div class="text-xs text-gray-600 mb-2">${project ? project.name : 'N/A'}</div>
                            <div class="flex justify-between items-center text-xs">
                                <span class="px-2 py-0.5 bg-gray-100 rounded">${t.assignee}</span>
                            </div>
                            <div class="mt-2 text-xs text-gray-500">üéØ ${t.goal}</div>
                        </div>
                    `;
                }).join('');
            });
        }

        // ========================================
        // FEATURES
        // ========================================
        function loadFeatures() {
            const featuresList = document.getElementById('featuresList');
            if (!featuresList) return;
            
            featuresList.innerHTML = data.features.map(f => `
                <div class="bg-white rounded-lg shadow p-4 border-l-4 ${f.type === 'included' ? 'border-green-500' : 'border-yellow-500'}">
                    <h3 class="font-bold text-lg">${f.icon} ${f.name}</h3>
                    <p class="text-sm text-gray-600 mb-3">${f.desc}</p>
                    <span class="text-xs ${f.type === 'included' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'} px-2 py-1 rounded">
                        ${f.type === 'included' ? 'Inclus' : `+${f.price}‚Ç¨/mois`}
                    </span>
                </div>
            `).join('');
        }

        // ========================================
        // NOTIFICATIONS
        // ========================================
        function loadNotifications() {
            const list = document.getElementById('notificationsList');
            if (data.notifications.length === 0) {
                list.innerHTML = '<div class="p-3 text-center text-gray-500 text-sm">Aucune notification</div>';
                document.getElementById('notifBadge').classList.add('hidden');
                return;
            }
            
            list.innerHTML = data.notifications.map(n => `
                <div class="p-3 hover:bg-gray-50">
                    <div class="flex items-start">
                        <span class="mr-2">${n.type === 'warning' ? '‚ö†Ô∏è' : n.type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è'}</span>
                        <div class="flex-1">
                            <div class="text-sm">${n.message}</div>
                            <div class="text-xs text-gray-500 mt-1">${n.time}</div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('notifBadge').classList.remove('hidden');
            document.getElementById('notifBadge').textContent = data.notifications.length;
        }

        function toggleNotifications() {
            document.getElementById('notificationsPanel').classList.toggle('hidden');
        }

        function addNotification(type, message, time) {
            const newId = Math.max(...data.notifications.map(n => n.id || 0), 0) + 1;
            data.notifications.unshift({id: newId, type, message, time});
            if (data.notifications.length > 10) data.notifications.pop();
            loadNotifications();
            saveData();
        }

        // ========================================
        // AI ASSISTANT
        // ========================================
        function openAI() {
            showPage('ai');
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = `
                <div class="bg-blue-50 p-3 rounded-lg">
                    <strong>ü§ñ IA:</strong> Bonjour ! Je suis ton assistant RestaurantOS. Comment puis-je t'aider ?
                </div>
            `;
        }

        // ========================================
        // UTILITIES
        // ========================================
        function getProjectIcon(name) {
            if (name.toLowerCase().includes('bella')) return 'üçï';
            if (name.toLowerCase().includes('sushi')) return 'üç£';
            if (name.toLowerCase().includes('gourmet')) return 'üç∑';
            return 'üçΩÔ∏è';
        }

        function getStatusColor(status) {
            const colors = {
                prospect: 'bg-gray-200 text-gray-700',
                demo: 'bg-yellow-200 text-yellow-800',
                active: 'bg-green-200 text-green-800',
                churned: 'bg-red-200 text-red-800'
            };
            return colors[status] || 'bg-gray-200';
        }

        function getStatusText(status) {
            const texts = { prospect: 'Prospect', demo: 'D√©mo', active: 'Actif', churned: 'Inactif' };
            return texts[status] || status;
        }

        function getPriorityColor(priority) {
            const colors = { 
                low: 'border-gray-300', 
                medium: 'border-blue-400', 
                high: 'border-orange-400', 
                urgent: 'border-red-500' 
            };
            return colors[priority] || 'border-gray-300';
        }

        function logout() {
            if (confirm('D√©connexion ?')) {
                alert('√Ä bient√¥t !');
            }
        }

        // ========================================
        // AUTO-SAVE
        // ========================================
        setInterval(() => {
            if (!useFirebase) {
                saveData();
            }
        }, 5000);

        // ========================================
        // INIT APP
        // ========================================
        window.addEventListener('DOMContentLoaded', () => {
            // Auto-initialiser Firebase avec la config par d√©faut
            initFirebase(defaultFirebaseConfig);
            
            loadDarkMode();
            setTimeout(() => {
                loadData();
            }, 500);
        });
    </script>
</body>
</html>
